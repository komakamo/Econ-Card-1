<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç®„Ç≥„Éé„Éü„ÇØ„Çπ„Éª„Éû„Çπ„Çø„Éº - ÁµåÊ∏àÂ≠¶„Ç´„Éº„Éâ„Ç≤„Éº„É†</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS („Éá„Ç∂„Ç§„É≥Áî®) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '"Noto Sans JP"', 'sans-serif'],
                        mono: ['"Noto Sans JP"', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#06b6d4', // Cyan 500
                            600: '#0891b2', // Cyan 600
                            700: '#0e7490', // Cyan 700
                            900: '#164e63', // Cyan 900
                        },
                        dark: {
                            900: '#0f172a', // Slate 900
                            800: '#1e293b', // Slate 800
                            700: '#334155', // Slate 700
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM („Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (JSX„Çí„Éñ„É©„Ç¶„Ç∂„ÅßÂÆüË°å„Åô„Çã„Åü„ÇÅ„ÅÆ„Ç≥„É≥„Éë„Ç§„É©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆöÁæ© */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes floatUp {
            0% { transform: translate(-50%, 0) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -40px) scale(1.2); opacity: 0; }
        }
        .animate-float-up {
            animation: floatUp 1.2s ease-out forwards;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        .animate-shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .animate-slide-in-right {
            animation: slideInRight 0.5s ease-out forwards;
        }

        body {
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
            min-height: 100vh;
        }

        /* Scrollbar customization */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="antialiased selection:bg-brand-500 selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Sound Manager (Web Audio API) ---
        const SoundManager = {
            ctx: null,
            isMuted: false,

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            },

            playTone(freq, type, duration, vol = 0.1) {
                if (this.isMuted) return;
                try {
                    this.init();
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                    gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + duration);
                } catch (e) {
                    console.error("Audio error:", e);
                }
            },

            playClick() {
                this.playTone(800, 'sine', 0.1, 0.05);
            },

            playError() {
                if (this.isMuted) return;
                try {
                    this.init();
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(100, this.ctx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + 0.3);
                } catch (e) {
                    console.error(e);
                }
            },

            playSuccess() {
                this.playTone(1200, 'sine', 0.2, 0.1);
                setTimeout(() => this.playTone(1800, 'sine', 0.4, 0.1), 100);
            },

            playCard(type) {
                if (this.isMuted) return;
                if (type === 'ATTACK') {
                    this.playTone(300, 'square', 0.3, 0.05);
                } else if (type === 'POLICY') {
                    this.playTone(600, 'sine', 0.3, 0.05);
                } else {
                    // PRODUCTION
                    this.playTone(400, 'triangle', 0.1, 0.05);
                    setTimeout(() => this.playTone(600, 'triangle', 0.2, 0.05), 100);
                }
            },

            playGameEnd(win) {
                if (this.isMuted) return;
                if (win) {
                    this.playTone(523.25, 'triangle', 0.2, 0.1); // C5
                    setTimeout(() => this.playTone(659.25, 'triangle', 0.2, 0.1), 200); // E5
                    setTimeout(() => this.playTone(783.99, 'triangle', 0.4, 0.1), 400); // G5
                    setTimeout(() => this.playTone(1046.50, 'triangle', 0.8, 0.1), 600); // C6
                } else {
                    this.playTone(300, 'sawtooth', 0.4, 0.1);
                    setTimeout(() => this.playTone(250, 'sawtooth', 0.4, 0.1), 300);
                    setTimeout(() => this.playTone(200, 'sawtooth', 0.8, 0.1), 600);
                }
            }
        };

        // --- „Ç¢„Ç§„Ç≥„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà (SVGÂüã„ÇÅËæº„Åø) ---
        // GitHub PagesÁ≠â„ÅßÂ§ñÈÉ®„É©„Ç§„Éñ„É©„É™‰æùÂ≠ò„Å´„Çà„Çã„Ç®„É©„Éº„ÇíÈò≤„Åê„Åü„ÇÅSVG„ÇíÁõ¥Êé•ÂÆöÁæ©
        const IconWallet = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>
        );
        const IconTrendingUp = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        );
        const IconZap = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        );
        const IconShield = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        );
        const IconAlertCircle = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        );
        const IconArrowRight = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        );
        const IconRefreshCw = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
        );
        const IconBookOpen = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const IconVolume2 = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        );
        const IconVolumeX = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
        );

        // --- „Ç≤„Éº„É†„Éá„Éº„ÇøÂÆöÁæ© ---

        const CARD_TYPES = {
            PRODUCTION: {
                label: 'ÁîüÁî£',
                baseStyle: 'bg-slate-800 border-cyan-800 hover:border-cyan-400 hover:shadow-cyan-500/20 text-cyan-100',
                headerStyle: 'bg-cyan-950/50 text-cyan-400 border-b border-cyan-900',
                icon: <IconZap size={14} className="text-cyan-400" />
            },
            POLICY: {
                label: 'ÊîøÁ≠ñ',
                baseStyle: 'bg-slate-800 border-emerald-800 hover:border-emerald-400 hover:shadow-emerald-500/20 text-emerald-100',
                headerStyle: 'bg-emerald-950/50 text-emerald-400 border-b border-emerald-900',
                icon: <IconBookOpen size={14} className="text-emerald-400" />
            },
            ATTACK: {
                label: 'Â§ñ‰∫§',
                baseStyle: 'bg-slate-800 border-rose-800 hover:border-rose-400 hover:shadow-rose-500/20 text-rose-100',
                headerStyle: 'bg-rose-950/50 text-rose-400 border-b border-rose-900',
                icon: <IconShield size={14} className="text-rose-400" />
            },
        };

        const EVENTS = [
            {
                id: 1,
                name: 'ÂéüÊ≤π„Ç∑„Éß„ÉÉ„ÇØ',
                description: 'Ë≥áÊ∫ê‰æ°Ê†ºÈ´òÈ®∞„Åß„ÅÇ„Çâ„ÇÜ„ÇãÊîøÁ≠ñ„Ç≥„Çπ„Éà„Åå20%‰∏äÊòá„Åó„Åæ„Åô„ÄÇ',
                effect: { costMultiplier: 1.2 },
            },
            {
                id: 2,
                name: 'Á∑äÁ∏ÆË≤°Êîø',
                description: 'Ë≤°ÊîøÂÜçÂª∫„ÅÆ„Åü„ÇÅÂèéÂÖ•„ÅåÊØé„Çø„Éº„É≥3ÂÖÜÂÜÜÊ∏õÂ∞ë„Åó„Åæ„Åô„ÄÇ',
                effect: { incomePenalty: 3 },
            },
            {
                id: 3,
                name: 'ÊäÄË°ìÈù©Êñ∞„Éñ„Éº„É†',
                description: '„Ç´„Éº„Éâ„ÅÆÁµåÊ∏àÂäπÊûú„Åå1.3ÂÄç„Å´Â¢óÂπÖ„Åó„Åæ„Åô„ÄÇ',
                effect: { effectMultiplier: 1.3 },
            },
            {
                id: 4,
                name: 'ÊôØÊ∞óÂæåÈÄÄ',
                description: '„Ç´„Éº„Éâ„ÅÆÁµåÊ∏àÂäπÊûú„Åå0.7ÂÄç„Å´Á∏ÆÂ∞è„Åó„ÄÅË≥áÈáëÁπ∞„Çä„ÅåÂé≥„Åó„Åè„Å™„Çä„Åæ„Åô„ÄÇ',
                effect: { effectMultiplier: 0.7, costMultiplier: 1.1 },
            },
        ];

        const ERAS = {
            GROWTH: {
                id: 'GROWTH',
                name: 'È´òÂ∫¶ÁµåÊ∏àÊàêÈï∑Êúü',
                description: 'GDP‚Üë „Ç§„É≥„Éï„É¨‚Üë',
                bgClass: 'bg-orange-900/10',
                effectDesc: 'GDP‰∏äÊòáÂäπÊûúÂ¢ó„Éª„Ç§„É≥„Éï„É¨Âä†ÈÄü'
            },
            STAGNATION: {
                id: 'STAGNATION',
                name: '„Éê„Éñ„É´Â¥©Â£ä„ÉªÂÅúÊªûÊúü',
                description: '„Ç≥„Çπ„ÉàÂ¢ó„Éª„Éá„Éï„É¨„ÉªÂèéÁõäÊ∏õ',
                bgClass: 'bg-slate-950',
                effectDesc: '„Ç´„Éº„Éâ„Ç≥„Çπ„ÉàÂ¢ó„ÉªÂèéÁõäÊ∏õ„Éª„Éá„Éï„É¨ÈÄ≤Ë°å'
            },
            IT_REV: {
                id: 'IT_REV',
                name: 'ITÈù©ÂëΩ„ÉªÊñ∞ÊôÇ‰ª£',
                description: 'ÊäÄË°ì„Ç´„Éº„ÉâÂäπÊûú2ÂÄç',
                bgClass: 'bg-cyan-950/20',
                effectDesc: 'ÊäÄË°ìÁ≥ª„Ç´„Éº„Éâ„ÅÆÂäπÊûú„Åå2ÂÄç'
            }
        };

        const INITIAL_DECK = [
            {
                id: 1,
                name: 'Ë®≠ÂÇôÊäïË≥á',
                cost: 30,
                type: 'PRODUCTION',
                effect: (me, opp) => ({ ...me, income: me.income + 5, gdp: me.gdp + 10 }),
                description: 'Â∑•Â†¥„ÅÆÊ©üÊ¢∞„Å™„Å©„ÇíË≥ºÂÖ•„Åó„ÄÅÁîüÁî£ËÉΩÂäõ„ÇíÈ´ò„ÇÅ„Åæ„Åô„ÄÇ',
                tip: '„ÄêÊäïË≥á„ÅÆ‰πóÊï∞ÂäπÊûú„ÄëÊäïË≥á„ÅØÂ∞ÜÊù•„ÅÆÁîüÁî£Âäõ„Å®ÊâÄÂæó„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åô„ÄÇ',
                providesTag: 'infrastructure',
                combosWith: ['infrastructure']
            },
            {
                id: 2,
                name: 'ÊäÄË°ìÈù©Êñ∞',
                cost: 60,
                type: 'PRODUCTION',
                effect: (me, opp) => ({ ...me, income: me.income + 10, gdp: me.gdp + 30 }),
                description: 'AI„ÇÑ„É≠„Éú„ÉÉ„Éà„Å™„Å©„ÅÆÊñ∞ÊäÄË°ì„ÇíÂ∞éÂÖ•„Åó„ÄÅÂäπÁéá„ÇíÂäáÁöÑ„Å´‰∏ä„Åí„Åæ„Åô„ÄÇ',
                tip: '„Äê„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥„ÄëÊäÄË°ìÈÄ≤Ê≠©„ÅØÁµåÊ∏àÊàêÈï∑„ÅÆÊúÄÂ§ß„ÅÆË¶ÅÂõ†„ÅÆ‰∏Ä„Å§„Åß„Åô„ÄÇ',
                providesTags: ['innovation', 'tech'],
                combosWith: ['education', 'infrastructure']
            },
            {
                id: 3,
                name: 'ÂÖ¨ÂÖ±‰∫ãÊ•≠',
                cost: 40,
                type: 'POLICY',
                inflationChange: 1,
                supportChange: 8,
                effect: (me, opp) => ({ ...me, gdp: me.gdp + 25 }),
                description: 'ÈÅìË∑Ø„ÇÑÊ©ã„Çí‰Ωú„Çä„ÄÅÈõáÁî®„Å®ÈúÄË¶Å„ÇíÁîü„ÅøÂá∫„Åó„Åæ„Åô„ÄÇ',
                tip: '„ÄêË≤°ÊîøÊîøÁ≠ñ„ÄëÊîøÂ∫ú„ÅåÊîØÂá∫„ÇíË°å„ÅÜ„Åì„Å®„Åß„ÄÅÊúâÂäπÈúÄË¶Å„ÇíÂâµÂá∫„Åó„Åæ„Åô„ÄÇ',
                providesTag: 'infrastructure'
            },
            {
                id: 4,
                name: 'ÈáëËûçÁ∑©Âíå',
                cost: 0,
                type: 'POLICY',
                inflationChange: 1.5,
                supportChange: 2,
                effect: (me, opp) => ({ ...me, money: me.money + 40 }),
                description: 'Â∏ÇÂ†¥„Å´„ÅäÈáë„ÇíÊµÅ„ÅóËæº„Åø„ÄÅ‰∏ÄÊôÇÁöÑ„Å´Ë≥áÈáë„ÇíÊΩ§Ê≤¢„Å´„Åó„Åæ„Åô„ÄÇ',
                tip: '„Äê„Éû„Éç„Çø„É™„Éº„Éô„Éº„Çπ„ÄëÈáëÂà©„Çí‰∏ã„Åí„Åü„Çä„ÅäÈáë„ÅÆ‰æõÁµ¶Èáè„ÇíÂ¢ó„ÇÑ„Åó„ÄÅÊäïË≥á„Çí‰øÉ„Åó„Åæ„Åô„ÄÇ'
            },
            {
                id: 5,
                name: 'Â¢óÁ®é',
                cost: 0,
                type: 'POLICY',
                inflationChange: -1,
                supportChange: -12,
                baseSuccessRate: 90,
                effect: (me, opp) => ({ ...me, money: me.money + 60, gdp: me.gdp - 10 }),
                description: 'Á®éÁéá„Çí‰∏ä„ÅíË≥áÈáë„ÇíÁ¢∫‰øù„Åó„Åæ„Åô„Åå„ÄÅÊôØÊ∞ó„ÅØÂ∞ë„ÅóÂÜ∑„ÅàËæº„Åø„Åæ„Åô„ÄÇ',
                tip: '„ÄêÁ∑äÁ∏ÆË≤°Êîø„ÄëË≤°Ê∫êÁ¢∫‰øù„Å´„ÅØÊúâÂäπ„Åß„Åô„Åå„ÄÅÊ∂àË≤ª„ÇÑÊäïË≥á„ÇíÊäëÂà∂„Åô„ÇãÂâØ‰ΩúÁî®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ',
                onFailure: (me) => ({ ...me, support: Math.max(0, me.support - 10) })
            },
            {
                id: 6,
                name: '„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„ÉóÊîØÊè¥',
                cost: 20,
                type: 'PRODUCTION',
                supportChange: 4,
                effect: (me, opp) => ({ ...me, income: me.income + 8 }),
                description: 'Ëµ∑Ê•≠ÂÆ∂„ÇíÊîØÊè¥„Åó„ÄÅÊñ∞„Åü„Å™„Éì„Ç∏„Éç„Çπ„ÇíËÇ≤„Å¶„Åæ„Åô„ÄÇ',
                tip: '„ÄêÊñ∞Áî£Ê•≠ÂâµÂá∫„ÄëÊñ∞„Åó„ÅÑ‰ºÅÊ•≠„ÅØÂ∞ÜÊù•„ÅÆÂ§ß„Åç„Å™Á®éÂèéÊ∫ê„Å®„Å™„Çä„Åæ„Åô„ÄÇ',
                providesTags: ['tech'],
                combosWith: ['innovation', 'education']
            },
            {
                id: 7,
                name: 'Èñ¢Á®éÂºï„Åç‰∏ä„Åí',
                cost: 15,
                type: 'ATTACK',
                targetSupportChange: -5,
                targetEffect: (opp) => ({ ...opp, income: Math.max(0, opp.income - 5), money: Math.max(0, opp.money - 10) }),
                description: 'Ëº∏ÂÖ•ÂìÅ„Å´Á®éÈáë„Çí„Åã„Åë„ÄÅÁõ∏ÊâãÂõΩ„ÅÆËº∏Âá∫Áî£Ê•≠„Å´„ÉÄ„É°„Éº„Ç∏„Çí‰∏é„Åà„Åæ„Åô„ÄÇ',
                tip: '„Äê‰øùË≠∑Ë≤øÊòì„ÄëËá™ÂõΩÁî£Ê•≠„ÇíÂÆà„Çã‰∏ÄÊñπ„Åß„ÄÅË≤øÊòìÊà¶‰∫â„ÅÆ„É™„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ'
            },
            {
                id: 8,
                name: '‰∫∫ÊùêËÇ≤Êàê',
                cost: 25,
                type: 'PRODUCTION',
                supportChange: 5,
                effect: (me, opp) => ({ ...me, income: me.income + 3, gdp: me.gdp + 15 }),
                description: 'ÊïôËÇ≤„Å´ÊäïË≥á„Åó„ÄÅÂä¥ÂÉçËÄÖ„ÅÆ„Çπ„Ç≠„É´„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ',
                tip: '„Äê‰∫∫ÁöÑË≥áÊú¨„ÄëÊïôËÇ≤„É¨„Éô„É´„ÅÆÂêë‰∏ä„ÅØ„ÄÅÈï∑ÊúüÁöÑ„Å™ÁµåÊ∏àÊàêÈï∑„Å´‰∏çÂèØÊ¨†„Åß„Åô„ÄÇ',
                providesTag: 'education'
            },
            {
                id: 9,
                name: 'Â§ßË¶èÊ®°ÈáëËûçÁ∑©Âíå',
                cost: 0,
                type: 'POLICY',
                inflationChange: 3,
                supportChange: 5,
                baseSuccessRate: 80,
                effect: (me, opp) => ({ ...me, money: me.money + 100 }),
                description: 'Áï∞Ê¨°ÂÖÉ„ÅÆÈáëËûçÁ∑©Âíå„ÇíË°å„ÅÑ„ÄÅÂ∏ÇÂ†¥„Å´Â§ßÈáè„ÅÆË≥áÈáë„Çí‰æõÁµ¶„Åó„Åæ„Åô„ÄÇ',
                tip: '„Äê„É™„Çπ„ÇØ„ÄëÂ§±Êïó„Åô„Çã„Å®Â∏ÇÂ†¥„ÅÆ‰ø°Ë™ç„ÇíÂ§±„ÅÑ„ÄÅÊîØÊåÅÁéá„ÅåÊÄ•ËêΩ„Åó„Åæ„Åô„ÄÇ',
                onFailure: (me) => ({ ...me, support: Math.max(0, me.support - 20) })
            },
        ];

        const WINNING_GDP = 300;
        const INFLATION_MIN = -5;
        const INFLATION_MAX = 15;

        const RATING_TIERS = [
            { label: 'AAA', threshold: 0, interestMultiplier: 1, eventDamageMultiplier: 1 },
            { label: 'BBB', threshold: 150, interestMultiplier: 1.25, eventDamageMultiplier: 1.1 },
            { label: 'CCC', threshold: 250, interestMultiplier: 1.6, eventDamageMultiplier: 1.25 },
            { label: 'D', threshold: 400, interestMultiplier: 2, eventDamageMultiplier: 1.5 },
        ];

        const getRatingByDebt = (debt = 0) => {
            const sorted = [...RATING_TIERS].sort((a, b) => b.threshold - a.threshold);
            const found = sorted.find(tier => debt >= tier.threshold);
            return found?.label ?? 'AAA';
        };

        const getRatingInfo = (rating = 'AAA') => RATING_TIERS.find(tier => tier.label === rating) ?? RATING_TIERS[0];

        const clampInflation = (value) => Math.min(INFLATION_MAX, Math.max(INFLATION_MIN, Number(value.toFixed(1))));

        const applyInflationDrift = (value, target = 0) => {
            const diff = target - value;
            const step = 0.3;
            if (Math.abs(diff) < step) return target;
            return clampInflation(value + (diff > 0 ? step : -step));
        };

        const applyInflationChange = (state, delta = 0) => {
            if (!delta) return state;
            return { ...state, inflation: clampInflation((state.inflation ?? 0) + delta) };
        };

        const calculateInflatedCost = (baseCost, inflationRate = 0) => {
            return Math.max(0, Math.round(baseCost * (1 + inflationRate / 100)));
        };

        const calculateSuccessRate = (card, support) => {
            const base = card.baseSuccessRate ?? 100;
            if (base >= 100) return 100;
            // Bonus: (Support - 50) * 0.5. Support 70 -> +10%. Support 30 -> -10%.
            const bonus = (support - 50) * 0.5;
            return Math.min(100, Math.max(0, Math.round(base + bonus)));
        };

        // --- Visual Components ---

        const NumberCounter = ({ value, duration = 1000 }) => {
            const [displayValue, setDisplayValue] = useState(value);

            useEffect(() => {
                let startTime;
                let animationFrameId;
                const startValue = displayValue;
                const endValue = value;

                if (startValue === endValue) return;

                const animate = (currentTime) => {
                    if (!startTime) startTime = currentTime;
                    const progress = Math.min((currentTime - startTime) / duration, 1);
                    // Ease out quart
                    const ease = 1 - Math.pow(1 - progress, 4);

                    const current = Math.floor(startValue + (endValue - startValue) * ease);
                    setDisplayValue(current);

                    if (progress < 1) {
                        animationFrameId = requestAnimationFrame(animate);
                    }
                };
                animationFrameId = requestAnimationFrame(animate);

                return () => cancelAnimationFrame(animationFrameId);
            }, [value]);

            return <span>{displayValue}</span>;
        };

        const TurnOverlay = ({ turn, show }) => {
            if (!show) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center pointer-events-none">
                    <div className="bg-slate-900/90 text-cyan-400 text-6xl font-black px-12 py-6 rounded-2xl border-4 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.5)] animate-pop-in">
                        TURN {turn}
                    </div>
                </div>
            );
        };

        const Confetti = () => {
            const particles = Array.from({ length: 50 }).map((_, i) => ({
                id: i,
                left: Math.random() * 100 + '%',
                animationDelay: Math.random() * 2 + 's',
                bg: ['#06b6d4', '#ec4899', '#eab308'][Math.floor(Math.random() * 3)]
            }));

            return (
                <div className="fixed inset-0 pointer-events-none z-[60] overflow-hidden">
                    {particles.map(p => (
                        <div
                            key={p.id}
                            style={{
                                position: 'absolute',
                                top: '-10px',
                                left: p.left,
                                width: '10px',
                                height: '10px',
                                backgroundColor: p.bg,
                                animation: `fall ${2 + Math.random() * 3}s linear infinite`,
                                animationDelay: p.animationDelay
                            }}
                        />
                    ))}
                    <style>{`
                        @keyframes fall {
                            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
                            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
                        }
                    `}</style>
                </div>
            );
        };

        const StatusPanel = ({ data, isEnemy, interest, isShaking }) => {
            if (!data) return <div className="p-4 border rounded text-red-500">Error: No Data</div>;

            const inflationAlert = (value) => {
                if (value >= 12) return { label: '„Éè„Ç§„Éë„Éº„Ç§„É≥„Éï„É¨', color: 'text-red-400 bg-red-900/30 border-red-500' };
                if (value >= 8) return { label: 'È´ò„Ç§„É≥„Éï„É¨', color: 'text-orange-400 bg-orange-900/30 border-orange-500' };
                if (value >= 4) return { label: '„Ç§„É≥„Éï„É¨ÈÄ≤Ë°å', color: 'text-amber-400 bg-amber-900/30 border-amber-500' };
                if (value <= -2) return { label: '„Éá„Éï„É¨', color: 'text-cyan-400 bg-cyan-900/30 border-cyan-500' };
                return { label: 'ÂÆâÂÆö', color: 'text-emerald-400 bg-emerald-900/30 border-emerald-500' };
            };

            const alert = inflationAlert(data.inflation || 0);

            // Theme colors (Dark Mode)
            const theme = isEnemy ? {
                bg: 'bg-slate-800/80',
                border: 'border-slate-700',
                text: 'text-slate-300',
                accent: 'text-slate-400',
                highlight: 'bg-slate-700',
                bar: 'bg-slate-500'
            } : {
                bg: 'bg-slate-800/90',
                border: 'border-cyan-900',
                text: 'text-slate-200',
                accent: 'text-cyan-400',
                highlight: 'bg-cyan-950',
                bar: 'bg-cyan-500'
            };

            return (
                <div className={`relative overflow-hidden p-5 rounded-2xl border-2 transition-all duration-300 backdrop-blur-sm ${theme.bg} ${theme.border} ${!isEnemy && 'shadow-xl shadow-cyan-900/10 ring-1 ring-cyan-500/20'} ${isShaking ? 'animate-shake' : ''}`}>
                    {/* Header */}
                    <div className="flex justify-between items-start mb-6">
                        <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-xl flex items-center justify-center shadow-sm ${isEnemy ? 'bg-slate-700 text-slate-400 border border-slate-600' : 'bg-gradient-to-br from-cyan-600 to-cyan-500 text-white shadow-cyan-900/50'}`}>
                                {isEnemy ? <IconZap size={20} /> : <IconWallet size={20} />}
                            </div>
                            <div>
                                <div className="flex items-center gap-2">
                                    <h3 className={`font-bold text-lg leading-none ${theme.text}`}>
                                        {isEnemy ? '„É©„Ç§„Éê„É´ÂõΩ' : 'Ëá™ÂõΩ („ÅÇ„Å™„Åü)'}
                                    </h3>
                                    <span className={`text-[10px] font-extrabold px-1.5 py-0.5 rounded uppercase tracking-wider ${isEnemy ? 'bg-slate-700 text-slate-400' : 'bg-cyan-950 text-cyan-400 border border-cyan-900'}`}>
                                        {isEnemy ? 'AI' : 'YOU'}
                                    </span>
                                </div>
                                <div className="text-xs text-slate-400 mt-1 font-medium flex items-center gap-1">
                                    ‰ø°Áî®Ê†º‰ªò:
                                    <span className={`font-bold ${['AAA','BBB'].includes(data.rating) ? 'text-emerald-400' : 'text-amber-400'}`}>{data.rating}</span>
                                </div>
                            </div>
                        </div>

                        <div className="text-right">
                            <div className="text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-0.5">GDP (Goal: 300)</div>
                            <div className={`text-3xl font-black tracking-tighter ${isEnemy ? 'text-slate-500' : 'text-cyan-400'}`}>
                                <NumberCounter value={data.gdp} /><span className="text-sm font-bold ml-1 text-slate-600">ÂÖÜ</span>
                            </div>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-2 gap-3 mb-4">
                        {/* Money */}
                        <div className={`${theme.highlight} p-3 rounded-xl border border-slate-700/50`}>
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-slate-500 flex items-center gap-1">
                                    Ë≥áÈáëÊÆãÈ´ò
                                </span>
                                <span className="text-sm font-bold font-mono text-slate-300">¬•<NumberCounter value={data.money} /></span>
                            </div>
                            <div className="w-full bg-slate-900 rounded-full h-1.5 overflow-hidden mb-2">
                                <div className={`h-full rounded-full transition-all duration-500 ${theme.bar}`} style={{ width: `${Math.min(100, data.money)}%` }}></div>
                            </div>
                            <div className="flex justify-between text-[10px] font-medium text-slate-400">
                                <span>ÂèéÊîØ: <span className="text-emerald-400">+<NumberCounter value={data.income} /></span></span>
                                <span>Âà©Êâï: <span className="text-rose-400">-<NumberCounter value={interest} /></span></span>
                            </div>
                        </div>

                        {/* Support */}
                        <div className={`${theme.highlight} p-3 rounded-xl border border-slate-700/50`}>
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-slate-500">ÂõΩÊ∞ëÊîØÊåÅÁéá</span>
                                <span className={`text-sm font-bold font-mono ${data.support < 30 ? 'text-rose-400' : 'text-slate-300'}`}><NumberCounter value={data.support} />%</span>
                            </div>
                            <div className="w-full bg-slate-900 rounded-full h-1.5 overflow-hidden">
                                <div className={`h-full rounded-full transition-all duration-500 ${data.support < 30 ? 'bg-rose-500' : 'bg-indigo-500'}`} style={{ width: `${data.support}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* Footer Stats */}
                    <div className="flex gap-2">
                        <div className="flex-1 bg-slate-900/50 p-2 rounded-lg border border-slate-700/50 flex justify-between items-center">
                            <span className="text-[10px] font-bold text-slate-500">ÂÇµÂãôÊÆãÈ´ò</span>
                            <span className="text-xs font-bold text-slate-400"><NumberCounter value={data.debt} />ÂÖÜ</span>
                        </div>
                        <div className={`flex-1 p-2 rounded-lg border flex justify-between items-center ${alert.color}`}>
                            <span className="text-[10px] font-bold opacity-70">„Ç§„É≥„Éï„É¨</span>
                            <span className="text-xs font-bold">{data.inflation.toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- „É°„Ç§„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---

        function EconomicCardGame() {
            const [turn, setTurn] = useState(1);
            const [era, setEra] = useState(ERAS.GROWTH);
            const [gameState, setGameState] = useState('START'); // START, PLAYING, WON, LOST
            const [logs, setLogs] = useState(['„Ç≤„Éº„É†ÈñãÂßãÔºÅÁõÆÊ®ôÔºöGDP 300ÂÖÜÂÜÜÂà∞ÈÅî']);
            const [activeEvent, setActiveEvent] = useState(null);
            const [lastTags, setLastTags] = useState([]);
            const [isMuted, setIsMuted] = useState(false);
            const [lastPlayedCard, setLastPlayedCard] = useState(null); // Purely for UI visualization
            const [floatingTexts, setFloatingTexts] = useState([]);
            const [showTurnOverlay, setShowTurnOverlay] = useState(false);
            const [shake, setShake] = useState({ player: false, enemy: false });

            useEffect(() => {
                SoundManager.isMuted = isMuted;
            }, [isMuted]);

            // Update Era based on progress
            useEffect(() => {
                if (gameState !== 'PLAYING') return;

                let nextEra = ERAS.GROWTH;
                // Phase 3: IT Revolution
                if (turn >= 15 || (player && player.gdp >= 200)) {
                    nextEra = ERAS.IT_REV;
                }
                // Phase 2: Stagnation
                else if (turn >= 8 || (player && player.gdp >= 100)) {
                    nextEra = ERAS.STAGNATION;
                }

                if (nextEra.id !== era.id) {
                    setEra(nextEra);
                    addLog(`üì¢ ÊôÇ‰ª£Â§âÈÅ∑: „Äå${nextEra.name}„Äç„Å´Á™ÅÂÖ•„Åó„Åæ„Åó„ÅüÔºÅ(${nextEra.effectDesc})`);
                    SoundManager.playTone(200, 'sawtooth', 0.5, 0.05); // Era change sound
                }
            }, [turn, player, gameState]); // Changed dependency from player.gdp to player to avoid undefined access

            useEffect(() => {
                // Show turn overlay on turn change
                if (gameState === 'PLAYING') {
                    setShowTurnOverlay(true);
                    const timer = setTimeout(() => setShowTurnOverlay(false), 2000);
                    return () => clearTimeout(timer);
                }
            }, [turn, gameState]);

            const triggerShake = (target) => { // 'player' or 'enemy'
                setShake(prev => ({ ...prev, [target]: true }));
                setTimeout(() => setShake(prev => ({ ...prev, [target]: false })), 500);
            };
            
            // „Éó„É¨„Ç§„É§„ÉºÁä∂ÊÖã
            const [player, setPlayer] = useState({
                name: '„ÅÇ„Å™„Åü',
                money: 100,
                income: 10,
                gdp: 0,
                inflation: 0,
                support: 70,
                debt: 0,
                rating: 'AAA',
                interestDue: 0,
            });
            const [playerHand, setPlayerHand] = useState([]);

            // AIÁä∂ÊÖã
            const [enemy, setEnemy] = useState({
                name: '„É©„Ç§„Éê„É´ÂõΩ',
                money: 100,
                income: 10,
                gdp: 0,
                inflation: 0,
                support: 70,
                debt: 0,
                rating: 'AAA',
                interestDue: 0,
            });

            // UI Enhancement: Add Floating Text
            const addFloatingText = (x, y, text, type = 'default') => {
                const id = Math.random();
                // Determine color based on type
                let colorClass = 'text-white';
                if (type === 'cost') colorClass = 'text-amber-400';
                if (type === 'income') colorClass = 'text-emerald-400';
                if (type === 'damage') colorClass = 'text-rose-500';

                setFloatingTexts(prev => [...prev, { id, x, y, text, colorClass }]);
                setTimeout(() => {
                    setFloatingTexts(prev => prev.filter(ft => ft.id !== id));
                }, 1000);
            };

            // ... (Logic functions remain unchanged)

            const getInflationAlert = (value) => {
                // Not used in UI but kept for logic consistency if needed
                if (value >= 12) return { label: '‚ö†Ô∏è „Éè„Ç§„Éë„Éº„Ç§„É≥„Éï„É¨Êá∏Âøµ', color: 'text-red-700 bg-red-100 border-red-200' };
                // ...
            };

            const applyUnrestPenalty = (state, actorLabel) => {
                if (state.inflation < 8) return state;

                const angerLevel = state.inflation >= 12 ? 'Ëá®Áïå' : state.inflation >= 10 ? 'È´ò„Åæ„Çä' : '‰∏äÊòá';
                const incomePenalty = state.inflation >= 12 ? 4 : 2;
                const gdpPenalty = state.inflation >= 10 ? 5 : 0;
                const penalizedState = {
                    ...state,
                    income: Math.max(0, state.income - incomePenalty),
                    gdp: Math.max(0, state.gdp - gdpPenalty),
                };

                addLog(`${actorLabel}: „Ç§„É≥„Éï„É¨È´òÈ®∞„Å´„Çà„Çä„ÄåÂõΩÊ∞ë„ÅÆ‰∏çÊ∫Ä„Äç„Åå${angerLevel}„ÄÅÊâÄÂæó-${incomePenalty}${gdpPenalty ? ` / GDP-${gdpPenalty}` : ''}`);
                return penalizedState;
            };

            const applySupportChange = (state, delta = 0, actorLabel, reason) => {
                if (!delta) return state;
                const prevSupport = state.support ?? 0;
                const nextSupport = Math.min(100, Math.max(0, prevSupport + delta));
                addLog(`${actorLabel}: ${reason}„ÅßÊîØÊåÅÁéá„Åå${prevSupport}% ‚Üí ${nextSupport}%„Å´Â§âÂåñ`);
                return { ...state, support: nextSupport };
            };

            const applyRatingUpdate = (state, actorLabel) => {
                const nextRating = getRatingByDebt(state.debt ?? 0);
                if (state.rating === nextRating) return state;
                addLog(`${actorLabel}: ÂÇµÂãôÊÆãÈ´ò${state.debt}ÂÖÜ„Å´„Çà„ÇäÊ†º‰ªò„Åë„Åå${state.rating} ‚Üí ${nextRating}„Å´Â§âÂåñ`);
                return { ...state, rating: nextRating };
            };

            const getInterestForTurn = (state) => {
                const ratingInfo = getRatingInfo(state.rating);
                return Math.max(0, Math.round((state.interestDue ?? 0) * ratingInfo.interestMultiplier));
            };

            const applyInterestPayment = (state, actorLabel) => {
                const interest = getInterestForTurn(state);
                if (!interest) return state;
                const afterPayment = { ...state, money: Math.max(0, state.money - interest) };
                addLog(`${actorLabel}: ÂÇµÂãôÂà©Êâï„ÅÑ„Å®„Åó„Å¶ ${interest}ÂÖÜÂÜÜ„ÇíÊîØÊâï„ÅÑ„Åæ„Åó„ÅüÔºàÊ†º‰ªò„Åë: ${state.rating}Ôºâ`);
                return afterPayment;
            };

            // ÂàùÊúüÂåñ
            const startGame = () => {
                SoundManager.init();
                SoundManager.playSuccess();
                const event = chooseRandomEvent();
                setActiveEvent(event);
                setPlayer({ money: 80, income: 20, gdp: 0, inflation: 0, support: 70, debt: 0, rating: 'AAA', interestDue: 0 });
                setEnemy({ money: 80, income: 20, gdp: 0, inflation: 0, support: 70, debt: 0, rating: 'AAA', interestDue: 0 });
                setPlayerHand([]);
                setLastTags([]);
                setTurn(1);
                setLogs([`üì¢ ‰ªä„Çø„Éº„É≥„ÅÆ„Ç§„Éô„É≥„Éà: „Äå${event.name}„Äç - ${event.description}`, '„Ç≤„Éº„É†ÈñãÂßãÔºÅGDP 300ÂÖÜÂÜÜ„ÇíÁõÆÊåá„ÅõÔºÅ']);
                setGameState('PLAYING');
                setLastPlayedCard(null);
                setFloatingTexts([]);
                drawCards(3);
            };

            const addLog = (msg) => {
                setLogs(prev => [msg, ...prev].slice(0, 10)); // Increased log size slightly
            };

            const chooseRandomEvent = () => EVENTS[Math.floor(Math.random() * EVENTS.length)];

            const selectTurnEvent = () => {
                const event = chooseRandomEvent();
                setActiveEvent(event);
                addLog(`üì¢ ‰ªä„Çø„Éº„É≥„ÅÆ„Ç§„Éô„É≥„Éà: „Äå${event.name}„Äç - ${event.description}`);
            };

            // „Ç´„Éº„Éâ„Éâ„É≠„ÉºÊ©üËÉΩ
            const drawCards = (count) => {
                const newCards = [];
                for (let i = 0; i < count; i++) {
                    const randomCard = INITIAL_DECK[Math.floor(Math.random() * INITIAL_DECK.length)];
                    newCards.push({ ...randomCard, uniqueId: Math.random() });
                }
                setPlayerHand(prev => [...prev, ...newCards]);
            };

            const issueBonds = (e) => {
                if (gameState !== 'PLAYING') return;
                SoundManager.playTone(1000, 'sine', 0.1, 0.1);

                // Show feedback
                if (e) {
                    addFloatingText(e.clientX, e.clientY, "+50", "income");
                }

                setPlayer(prev => {
                    const updated = {
                        ...prev,
                        money: prev.money + 50,
                        debt: (prev.debt ?? 0) + 50,
                        interestDue: (prev.interestDue ?? 0) + 5,
                    };
                    const rated = applyRatingUpdate(updated, '„ÅÇ„Å™„Åü');
                    addLog('„ÅÇ„Å™„Åü: ÂõΩÂÇµÁô∫Ë°åÔºÅË≥áÈáë+50ÂÖÜ / ÂÇµÂãô+50ÂÖÜ„ÄÅÂà©Êâï„ÅÑ5ÂÖÜ/„Çø„Éº„É≥„ÇíËøΩÂä†');
                    return rated;
                });
            };

            const applyEventMultiplier = (prevState, nextState) => {
                if (!activeEvent?.effect?.effectMultiplier) return nextState;
                const multiplier = activeEvent.effect.effectMultiplier;
                const applyScale = (key) => {
                    const delta = nextState[key] - prevState[key];
                    return prevState[key] + Math.round(delta * multiplier);
                };
                return {
                    ...nextState,
                    money: applyScale('money'),
                    income: applyScale('income'),
                    gdp: applyScale('gdp'),
                };
            };

            const COMBO_MULTIPLIER = 1.3;

            const applyComboBonus = (prevState, nextState, matchedTags = []) => {
                if (!matchedTags.length) return nextState;
                const applyScale = (key) => {
                    const delta = nextState[key] - prevState[key];
                    return prevState[key] + Math.round(delta * COMBO_MULTIPLIER);
                };
                return {
                    ...nextState,
                    money: applyScale('money'),
                    income: applyScale('income'),
                    gdp: applyScale('gdp'),
                };
            };

            const getCardProvidedTags = (card) => {
                const tags = [];
                if (Array.isArray(card?.providesTags)) {
                    tags.push(...card.providesTags);
                }
                if (card?.providesTag) {
                    tags.push(card.providesTag);
                }
                return tags;
            };

            const withEventMultiplier = (setter) => (updater) => setter(prev => {
                const next = typeof updater === 'function' ? updater(prev) : updater;
                return applyEventMultiplier(prev, next);
            });

            const calculateAdjustedCost = (baseCost, inflationRate = 0) => {
                const inflated = calculateInflatedCost(baseCost, inflationRate);
                let multiplier = activeEvent?.effect?.costMultiplier || 1;

                // Era Effect: Stagnation increases costs
                if (era.id === 'STAGNATION') {
                    multiplier *= 1.5;
                }

                return Math.max(0, Math.round(inflated * multiplier));
            };

            // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥Âá¶ÁêÜ
            const playCard = (card, e) => {
                if (gameState !== 'PLAYING') return;

                const adjustedCost = calculateAdjustedCost(card.cost, player.inflation);
                const comboReadyTags = (card.combosWith ?? []).filter(tag => lastTags.includes(tag));
                const providedTags = getCardProvidedTags(card);

                // Era Effect: IT Revolution (Tech x2)
                const isTech = providedTags.includes('tech');
                const eraMultiplier = (era.id === 'IT_REV' && isTech) ? 2 : 1;

                let updatedEnemyState = null;

                if (player.money < adjustedCost) {
                    SoundManager.playError();
                    addLog(`Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºàÂøÖË¶Å: ${adjustedCost}ÂÖÜÂÜÜ„ÄÅ„Ç§„É≥„Éï„É¨ÂΩ±Èüø„ÇíÂèçÊò†Ôºâ`);
                    return;
                }

                // Show feedback
                if (e) {
                    if (adjustedCost > 0) addFloatingText(e.clientX, e.clientY, `-${adjustedCost}`, "cost");
                }

                // Success Rate Check
                const successRate = calculateSuccessRate(card, player.support);
                const roll = Math.random() * 100;
                const isSuccess = roll < successRate;

                // Pay cost regardless of success (RISK!)
                const afterCost = { ...player, money: player.money - adjustedCost };

                let nextPlayerState = null;

                if (!isSuccess) {
                    // FAILURE
                    SoundManager.playError();
                    triggerShake('player');
                    addFloatingText(e.clientX, e.clientY, "FAILED!", "damage");
                    addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„ÅÆÂÆüË°å„Å´Â§±Êïó... (ÊàêÂäüÁéá ${successRate}%)`);

                    let penaltyState = afterCost;
                    if (card.onFailure) {
                        penaltyState = card.onFailure(penaltyState);
                        addLog(`ÂâØ‰ΩúÁî®: ÊîøÁ≠ñ„ÅÆÂ§±Êïó„Å´„Çà„ÇäÊîØÊåÅÁéá„ÅåÊÄ•ËêΩ„Åó„Åæ„Åó„Åü„ÄÇ`);
                    }
                    nextPlayerState = penaltyState;
                    setPlayer(nextPlayerState);

                    // Discard card
                    setLastPlayedCard(card);
                    setPlayerHand(prev => prev.filter(c => c.uniqueId !== card.uniqueId));

                    return checkWinCondition(nextPlayerState, enemy);
                }

                // SUCCESS
                SoundManager.playCard(card.type);

                if (comboReadyTags.length > 0) {
                    addLog(`üéØ „Ç≥„É≥„ÉúÁô∫ÂãïÔºÅ${comboReadyTags.join(', ')}„Çø„Ç∞„Å®„ÅÆÁõ∏‰πóÂäπÊûú„Åß„Äå${card.name}„Äç„ÅÆÂäπÊûú„ÅåÂº∑Âåñ„Åï„Çå„Åæ„Åô„ÄÇ`);
                }

                if (card.type === 'ATTACK') {
                    const afterSupport = applySupportChange(afterCost, card.supportChange, '„ÅÇ„Å™„Åü', `„Äå${card.name}„Äç„ÅÆÊîøÊ≤ªÁöÑÂΩ±Èüø`);
                    nextPlayerState = afterSupport;
                } else {
                    // 1. Base Effect
                    const baseState = card.effect(afterCost, enemy);

                    // 2. Apply Era Multiplier (IT_REV & GROWTH GDP Bonus)
                    let boostedState = baseState;

                    // IT Revolution: Tech cards effect doubled
                    if (eraMultiplier > 1) {
                         const keys = ['money', 'income', 'gdp'];
                         const boosted = { ...baseState };
                         keys.forEach(key => {
                             const delta = baseState[key] - afterCost[key];
                             if (delta !== 0) {
                                 boosted[key] = afterCost[key] + delta * eraMultiplier;
                             }
                         });
                         boostedState = boosted;
                    }

                    // GROWTH Era: GDP Boost
                    if (era.id === 'GROWTH') {
                        // Check if boostedState is valid, otherwise fallback
                        const currentGdp = boostedState ? boostedState.gdp : afterCost.gdp;
                        const deltaGdp = currentGdp - afterCost.gdp;
                        if (deltaGdp > 0 && boostedState) {
                            boostedState.gdp = afterCost.gdp + Math.round(deltaGdp * 1.5);
                        }
                    }

                    const comboBoosted = applyComboBonus(afterCost, boostedState, comboReadyTags);
                    const afterEvent = applyEventMultiplier(afterCost, comboBoosted);

                    // Inflation
                    let inflationDelta = card.inflationChange || 0;
                    if (era.id === 'GROWTH' && inflationDelta > 0) {
                        inflationDelta += 1; // GROWTH inflates faster
                    }
                    const afterInflation = applyInflationChange(afterEvent, inflationDelta);

                    if (inflationDelta) {
                        addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„ÅåÁâ©‰æ°„Å´ÂΩ±Èüø (${inflationDelta > 0 ? '+' : ''}${inflationDelta.toFixed(1)}%)`);
                    }
                    const afterUnrest = applyUnrestPenalty(afterInflation, '„ÅÇ„Å™„Åü');
                    const afterSupport = applySupportChange(afterUnrest, card.supportChange, '„ÅÇ„Å™„Åü', `„Äå${card.name}„Äç„ÅÆÂäπÊûú`);
                    nextPlayerState = afterSupport;
                }

                setPlayer(nextPlayerState);

                // ÂäπÊûúÁô∫Âãï
                if (card.type === 'ATTACK') {
                    const eventAwareSetEnemy = withEventMultiplier(setEnemy);
                    eventAwareSetEnemy(prev => {
                        const effected = card.targetEffect ? card.targetEffect(prev, nextPlayerState) : prev;
                        const comboBoosted = applyComboBonus(prev, effected, comboReadyTags);
                        const unrested = applyUnrestPenalty(comboBoosted, '„É©„Ç§„Éê„É´');
                        const withSupport = applySupportChange(unrested, card.targetSupportChange, '„É©„Ç§„Éê„É´', `„Äå${card.name}„Äç„ÅÆÂΩ±Èüø`);
                        updatedEnemyState = withSupport;
                        return withSupport;
                    });
                    triggerShake('enemy'); // Shake enemy panel
                    addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„Çí‰ΩøÁî®ÔºÅÁõ∏Êâã„ÇíÂ¶®ÂÆ≥„Åó„Åü„ÄÇ`);
                } else {
                    addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„Çí‰ΩøÁî®„ÄÇÁµåÊ∏àÂäπÊûúÁô∫ÂãïÔºÅ`);
                }

                // UI update for discard
                setLastPlayedCard(card);

                // ÊâãÊú≠„Åã„ÇâÂâäÈô§
                setPlayerHand(prev => prev.filter(c => c.uniqueId !== card.uniqueId));

                if (providedTags.length > 0) {
                    setLastTags(prev => Array.from(new Set([...prev, ...providedTags])));
                }

                return checkWinCondition(nextPlayerState, updatedEnemyState ?? enemy);
            };

            // „Çø„Éº„É≥ÁµÇ‰∫ÜÂá¶ÁêÜ & AI„Çø„Éº„É≥
            const endTurn = () => {
                if (gameState !== 'PLAYING') return;

                SoundManager.playClick();

                // Era Effect: Stagnation Deflation Drift
                let driftTarget = 0;
                let eraIncomePenalty = 0;
                if (era.id === 'STAGNATION') {
                    driftTarget = -2; // Drift towards deflation
                    eraIncomePenalty = 5; // Reduce income
                }

                // 1. ÂèéÂÖ•„ÅÆÂá¶ÁêÜÔºà„Éó„É¨„Ç§„É§„ÉºÔºâ
                const driftedInflation = applyInflationDrift(player.inflation, driftTarget);
                const ratingInfo = getRatingInfo(player.rating);
                const incomePenalty = Math.round((activeEvent?.effect?.incomePenalty ?? 0) * ratingInfo.eventDamageMultiplier) + eraIncomePenalty;
                const playerIncomeGain = Math.max(0, player.income - incomePenalty);
                let playerAfterIncome = {
                    ...player,
                    money: player.money + playerIncomeGain,
                    inflation: driftedInflation,
                };

                // Show Summary Feedback (Center screen)
                addFloatingText(window.innerWidth / 2, window.innerHeight / 2, `Income +${playerIncomeGain}`, "income");

                const interestPaid = getInterestForTurn(playerAfterIncome);
                playerAfterIncome = applyInterestPayment(playerAfterIncome, '„ÅÇ„Å™„Åü');
                const ratedPlayer = applyRatingUpdate(playerAfterIncome, '„ÅÇ„Å™„Åü');
                const unrestApplied = applyUnrestPenalty(ratedPlayer, '„ÅÇ„Å™„Åü');
                setPlayer(unrestApplied);
                addLog(`„Çø„Éº„É≥ÁµÇ‰∫Ü: ÂèéÂÖ• +${playerIncomeGain}ÂÖÜÂÜÜ${incomePenalty ? ` („Ç§„Éô„É≥„Éà„Åß-${incomePenalty})` : ''}„ÄÅÂà©Êâï„ÅÑ -${interestPaid}ÂÖÜÂÜÜ„ÄÅ„Ç§„É≥„Éï„É¨Áéá ${player.inflation.toFixed(1)} ‚Üí ${driftedInflation.toFixed(1)}%„ÄÅÊ†º‰ªò„Åë ${ratedPlayer.rating}`);

                // 2. ÂãùÂà©Âà§ÂÆö
                if (checkWinCondition()) return;

                // 3. AI„ÅÆ„Çø„Éº„É≥
                const aiEndedGame = aiTurn();

                // 4. Ê¨°„ÅÆ„Çø„Éº„É≥„ÅÆÊ∫ñÂÇô
                if (!aiEndedGame) {
                    setTurn(prev => prev + 1);
                    drawCards(1);
                    selectTurnEvent();
                }

                setLastTags([]);
            };

            const aiTurn = () => {
                let latestEnemyState = null;

                setEnemy(prev => {
                    const drifted = applyInflationDrift(prev.inflation);
                    if (drifted !== prev.inflation) {
                        addLog(`„É©„Ç§„Éê„É´: „Ç§„É≥„Éï„É¨Áéá ${prev.inflation.toFixed(1)}% ‚Üí ${drifted.toFixed(1)}% (Ëá™ÂãïË™øÊï¥)`);
                    }
                    const afterDrift = { ...prev, inflation: drifted };
                    const ratingInfo = getRatingInfo(afterDrift.rating);
                    const incomePenalty = Math.round((activeEvent?.effect?.incomePenalty ?? 0) * ratingInfo.eventDamageMultiplier);
                    const aiIncomeGain = Math.max(0, afterDrift.income - incomePenalty);
                    let afterIncome = { ...afterDrift, money: afterDrift.money + aiIncomeGain };
                    afterIncome = applyInterestPayment(afterIncome, '„É©„Ç§„Éê„É´');
                    const ratedEnemy = applyRatingUpdate(afterIncome, '„É©„Ç§„Éê„É´');
                    const unrestAdjusted = applyUnrestPenalty(ratedEnemy, '„É©„Ç§„Éê„É´');

                    const potentialActions = INITIAL_DECK.filter(c => calculateAdjustedCost(c.cost, unrestAdjusted.inflation) <= unrestAdjusted.money);

                    if (potentialActions.length === 0) {
                        addLog(`„É©„Ç§„Éê„É´: Ë≥áÈáë‰∏çË∂≥„ÅÆ„Åü„ÇÅË≥áÈáë„ÇíÊ∏©Â≠ò„ÄÇ`);
                        latestEnemyState = unrestAdjusted;
                        return unrestAdjusted;
                    }

                    const aiCard = potentialActions[Math.floor(Math.random() * potentialActions.length)];
                    const inflatedCost = calculateAdjustedCost(aiCard.cost, unrestAdjusted.inflation);
                    let afterPayment = { ...unrestAdjusted, money: unrestAdjusted.money - inflatedCost };

                    if (aiCard.type === 'ATTACK') {
                        const afterSupport = applySupportChange(afterPayment, aiCard.supportChange, '„É©„Ç§„Éê„É´', `„Äå${aiCard.name}„Äç„ÅÆÊîøÊ≤ªÁöÑÂΩ±Èüø`);
                        const eventAwareSetPlayer = withEventMultiplier(setPlayer);
                        eventAwareSetPlayer(prev => {
                            const effected = aiCard.targetEffect ? aiCard.targetEffect(prev, afterSupport) : prev;
                            const unrested = applyUnrestPenalty(effected, '„ÅÇ„Å™„Åü');
                            return applySupportChange(unrested, aiCard.targetSupportChange, '„ÅÇ„Å™„Åü', `„Äå${aiCard.name}„Äç„ÅÆÂΩ±Èüø`);
                        });
                        triggerShake('player'); // Shake player panel
                        addLog(`„É©„Ç§„Éê„É´: „Äå${aiCard.name}„Äç„Çí‰ΩøÁî®ÔºÅ`);
                        latestEnemyState = afterSupport;
                        return afterSupport;
                    }

                    const afterEffect = applyEventMultiplier(afterPayment, aiCard.effect(afterPayment, player));
                    const afterInflation = applyInflationChange(afterEffect, aiCard.inflationChange);
                    if (aiCard.inflationChange) {
                        addLog(`„É©„Ç§„Éê„É´: „Äå${aiCard.name}„Äç„ÅßÁâ©‰æ°„ÅåÂ§âÂãï (${aiCard.inflationChange > 0 ? '+' : ''}${aiCard.inflationChange}%)`);
                    }
                    addLog(`„É©„Ç§„Éê„É´: „Äå${aiCard.name}„Äç„Çí‰ΩøÁî®„ÅóÊàêÈï∑‰∏≠...`);
                    const unrested = applyUnrestPenalty(afterInflation, '„É©„Ç§„Éê„É´');
                    const afterSupport = applySupportChange(unrested, aiCard.supportChange, '„É©„Ç§„Éê„É´', `„Äå${aiCard.name}„Äç„ÅÆÂäπÊûú`);
                    latestEnemyState = afterSupport;
                    return afterSupport;
                });

                return checkWinCondition(player, latestEnemyState ?? enemy);
            };

            const checkWinCondition = (nextPlayer = player, nextEnemy = enemy) => {
                if (gameState !== 'PLAYING') return false;

                if (nextPlayer.gdp >= WINNING_GDP) {
                    setGameState('WON');
                    SoundManager.playGameEnd(true);
                    addLog('üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„ÅÇ„Å™„Åü„ÅÆÂõΩ„ÅÆÁµåÊ∏à„ÅåÂãùÂà©„Åó„Åæ„Åó„ÅüÔºÅ');
                    return true;
                }

                if (nextEnemy.gdp >= WINNING_GDP) {
                    setGameState('LOST');
                    SoundManager.playGameEnd(false);
                    addLog('üíÄ ÊÆãÂøµ... „É©„Ç§„Éê„É´ÂõΩ„Å´ÁµåÊ∏àË¶áÊ®©„ÇíÂ•™„Çè„Çå„Åæ„Åó„Åü„ÄÇ');
                    return true;
                }

                if (nextPlayer.support <= 0) {
                    setGameState('LOST');
                    SoundManager.playGameEnd(false);
                    addLog('üíÄ ÊîØÊåÅÁéá„Åå0%„Å´ËêΩ„Å°„ÄÅÊîøÊ®©„ÅåÂ¥©Â£ä„Åó„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇ');
                    return true;
                }

                if (nextEnemy.support <= 0) {
                    setGameState('WON');
                    SoundManager.playGameEnd(true);
                    addLog('üéâ „É©„Ç§„Éê„É´ÂõΩ„ÅÆÊîØÊåÅÁéá„ÅåÂ¥©Â£ä„Åó„ÄÅ„ÅÇ„Å™„Åü„ÅÆÂõΩ„ÅåÂÑ™‰Ωç„Å´Á´ã„Å°„Åæ„Åó„ÅüÔºÅ');
                    return true;
                }

                return false;
            };

            return (
                <div className={`min-h-screen text-slate-200 relative transition-colors duration-1000 ${era.bgClass}`}>
                    {gameState === 'WON' && <Confetti />}
                    <TurnOverlay turn={turn} show={showTurnOverlay} />

                    {/* Floating Text Overlay */}
                    {floatingTexts.map(ft => (
                        <div
                            key={ft.id}
                            className={`fixed pointer-events-none z-50 font-black text-2xl animate-float-up ${ft.colorClass}`}
                            style={{ left: ft.x, top: ft.y, textShadow: '0 2px 4px rgba(0,0,0,0.5)' }}
                        >
                            {ft.text}
                        </div>
                    ))}

                    {/* TOP HEADER */}
                    <header className="bg-slate-900/80 backdrop-blur border-b border-slate-800 sticky top-0 z-50">
                        {/* Era Indicator Progress Bar */}
                        <div className="absolute top-0 left-0 h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-rose-500 transition-all duration-1000" style={{ width: `${(turn / 30) * 100}%`, opacity: 0.5 }}></div>

                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-gradient-to-br from-cyan-600 to-blue-600 text-white p-2 rounded-lg shadow-lg shadow-cyan-500/20">
                                    <IconTrendingUp size={20} />
                                </div>
                                <div>
                                    <h1 className="text-xl font-black text-white tracking-tighter leading-none">Economics Master</h1>
                                    <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Strategic Card Game</p>
                                </div>
                            </div>

                            <div className="flex items-center gap-4">
                                <div className="hidden md:flex items-center gap-3">
                                    <div className="flex items-center gap-2 bg-slate-800/50 px-3 py-1.5 rounded-full border border-slate-700/50">
                                        <span className="text-xs font-bold text-amber-400">{era.name}</span>
                                    </div>
                                    <div className="flex items-center gap-2 bg-slate-800/50 px-3 py-1.5 rounded-full border border-slate-700/50">
                                        <span className="w-2 h-2 rounded-full bg-cyan-500 animate-pulse"></span>
                                        <span className="text-xs font-bold text-slate-300">TURN {turn}</span>
                                    </div>
                                    <div className="text-xs font-bold text-slate-500">GOAL: GDP {WINNING_GDP}T</div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={() => setIsMuted(!isMuted)}
                                        className="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors active:scale-95"
                                    >
                                        {isMuted ? <IconVolumeX size={18} /> : <IconVolume2 size={18} />}
                                    </button>
                                    <button
                                        onClick={startGame}
                                        className="text-xs font-bold bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg border border-slate-700 transition-all flex items-center gap-2 active:scale-95"
                                    >
                                        <IconRefreshCw size={14} />
                                        {gameState === 'START' ? 'Start' : 'Reset'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">

                        {/* LEFT/CENTER COLUMN (Game Board) */}
                        <div className="lg:col-span-9 space-y-6">
                            
                            {/* 1. OPPONENT FIELD */}
                            <section>
                                <StatusPanel data={enemy} isEnemy={true} interest={getInterestForTurn(enemy)} isShaking={shake.enemy} />
                            </section>

                            {/* 2. MIDDLE ZONE (Deck, Event, Discard) */}
                            <section className="grid grid-cols-1 md:grid-cols-3 gap-4 min-h-[140px]">
                                {/* Discard Pile (Visual) */}
                                <div className="hidden md:flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-slate-800 bg-slate-900/30 p-4 relative group">
                                    <span className="text-xs font-bold text-slate-700 uppercase mb-2">Discard / Last Played</span>
                                    {lastPlayedCard ? (
                                         <div className="w-20 h-28 bg-slate-800 border border-slate-600 rounded-lg flex items-center justify-center shadow-lg relative transform group-hover:scale-110 transition-transform">
                                            <div className="text-[10px] text-center p-1">
                                                <div className="font-bold text-slate-300 mb-1 truncate">{lastPlayedCard.name}</div>
                                                <div className="text-slate-500 text-[9px]">{CARD_TYPES[lastPlayedCard.type].label}</div>
                                            </div>
                                         </div>
                                    ) : (
                                        <div className="w-20 h-28 bg-transparent border border-slate-800 rounded-lg flex items-center justify-center opacity-30">
                                            <IconBookOpen size={20} />
                                        </div>
                                    )}
                                </div>

                                {/* Active Event (Center) */}
                                <div className="md:col-span-1">
                                    {activeEvent && gameState === 'PLAYING' ? (
                                        <div className="h-full bg-gradient-to-br from-amber-950/40 to-slate-900 border border-amber-900/50 p-4 rounded-xl flex flex-col justify-center relative overflow-hidden group">
                                            <div className="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
                                                <IconAlertCircle size={60} />
                                            </div>
                                            <div className="flex items-center gap-2 mb-2">
                                                <span className="bg-amber-900/50 text-amber-500 text-[10px] font-black px-2 py-0.5 rounded uppercase tracking-wider border border-amber-900">Event</span>
                                            </div>
                                            <h3 className="font-bold text-amber-500 text-lg leading-tight mb-1">{activeEvent.name}</h3>
                                            <p className="text-xs text-amber-200/70 leading-relaxed">{activeEvent.description}</p>
                                        </div>
                                    ) : (
                                        <div className="h-full flex items-center justify-center text-slate-700 text-xs font-bold uppercase tracking-widest border border-slate-800 rounded-xl bg-slate-900/50">
                                            No Active Event
                                        </div>
                                    )}
                                </div>

                                {/* Deck (Visual) */}
                                <div className="hidden md:flex flex-col items-center justify-center rounded-xl border border-slate-800 bg-slate-900/50 p-4">
                                     <div className="relative w-24 h-32 cursor-pointer hover:-translate-y-1 transition-transform">
                                        {/* Card Stack Effect */}
                                        <div className="absolute inset-0 bg-slate-800 rounded-lg border border-slate-700 translate-x-2 translate-y-2"></div>
                                        <div className="absolute inset-0 bg-slate-800 rounded-lg border border-slate-700 translate-x-1 translate-y-1"></div>
                                        <div className="absolute inset-0 bg-gradient-to-br from-slate-700 to-slate-800 rounded-lg border border-slate-600 flex items-center justify-center shadow-2xl">
                                            <div className="text-center">
                                                <IconTrendingUp className="text-cyan-900 mb-1 mx-auto" size={24} />
                                                <span className="text-[10px] font-bold text-cyan-900 uppercase tracking-widest">DECK</span>
                                            </div>
                                        </div>
                                     </div>
                                </div>
                            </section>

                            {/* 3. PLAYER FIELD */}
                            <section>
                                <StatusPanel data={player} isEnemy={false} interest={getInterestForTurn(player)} isShaking={shake.player} />
                            </section>

                            {/* 4. HAND AREA */}
                            <section className="bg-slate-900/50 rounded-2xl border border-slate-800 p-4 md:p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider flex items-center gap-2">
                                        <IconWallet size={16} /> Your Hand
                                    </h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={(e) => issueBonds(e)}
                                            disabled={gameState !== 'PLAYING'}
                                            className="bg-amber-700/20 text-amber-500 border border-amber-900/50 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-amber-700/40 transition-all disabled:opacity-50 flex items-center gap-1.5 active:scale-95"
                                        >
                                            <span className="w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                                            ÂõΩÂÇµÁô∫Ë°å (+50ÂÖÜ)
                                        </button>
                                        <button
                                            onClick={endTurn}
                                            disabled={gameState !== 'PLAYING'}
                                            className="bg-cyan-600 text-white px-5 py-1.5 rounded-lg text-xs font-bold hover:bg-cyan-500 hover:shadow-lg hover:shadow-cyan-500/20 transition-all disabled:opacity-50 flex items-center gap-2 active:scale-95"
                                        >
                                            „Çø„Éº„É≥ÁµÇ‰∫Ü <IconArrowRight size={14} />
                                        </button>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                    {playerHand.map((card) => {
                                        const typeInfo = CARD_TYPES[card.type];
                                        const inflatedCost = calculateAdjustedCost(card.cost, player.inflation);
                                        const canAfford = player.money >= inflatedCost;
                                        const comboReadyTags = (card.combosWith ?? []).filter(tag => lastTags.includes(tag));
                                        const providesTags = getCardProvidedTags(card);
                                        const successRate = calculateSuccessRate(card, player.support);
                                        const isRisky = successRate < 100;

                                        return (
                                            <button
                                                key={card.uniqueId}
                                                onClick={(e) => playCard(card, e)}
                                                disabled={!canAfford || gameState !== 'PLAYING'}
                                                className={`
                                                    relative text-left group
                                                    flex flex-col h-full rounded-xl border-2 transition-all duration-300 overflow-hidden
                                                    ${typeInfo.baseStyle}
                                                    ${canAfford ? 'cursor-pointer hover:-translate-y-1 hover:brightness-110 active:scale-95' : 'opacity-40 cursor-not-allowed grayscale border-slate-700 bg-slate-900'}
                                                `}
                                            >
                                                {/* Header */}
                                                <div className={`px-3 py-2 flex justify-between items-center ${typeInfo.headerStyle}`}>
                                                    <span className="text-[9px] font-black uppercase tracking-wider flex items-center gap-1">
                                                        {typeInfo.icon} {typeInfo.label}
                                                    </span>
                                                    <span className="font-mono text-base font-black tracking-tighter">¬•{inflatedCost}</span>
                                                </div>

                                                {/* Body */}
                                                <div className="p-3 flex flex-col flex-grow bg-slate-900/40 backdrop-blur-sm">
                                                    <h4 className="font-bold text-slate-200 text-xs mb-1.5 min-h-[2.5em] flex items-center leading-snug">
                                                        {card.name}
                                                    </h4>

                                                    <p className="text-[10px] text-slate-400 mb-3 flex-grow leading-relaxed line-clamp-3">
                                                        {card.description}
                                                    </p>

                                                    <div className="space-y-1">
                                                         {/* Cost Info */}
                                                        {inflatedCost !== card.cost && (
                                                            <div className="text-[9px] text-amber-500 bg-amber-950/30 px-1.5 py-0.5 rounded border border-amber-900/50 flex items-center gap-1 w-max">
                                                                <IconAlertCircle size={8} />
                                                                Cost: {card.cost}‚Üí{inflatedCost}
                                                            </div>
                                                        )}

                                                        {/* Success Rate Info (Only if risky or varied) */}
                                                        <div className={`text-[9px] px-1.5 py-0.5 rounded border flex items-center gap-1 w-max ${
                                                            isRisky
                                                                ? successRate < 70 ? 'text-red-400 bg-red-950/30 border-red-900/50' : 'text-orange-400 bg-orange-950/30 border-orange-900/50'
                                                                : 'text-emerald-400 bg-emerald-950/30 border-emerald-900/50'
                                                        }`}>
                                                            {isRisky && <IconAlertCircle size={8} />}
                                                            ÊàêÂäüÁéá: {successRate}%
                                                        </div>

                                                        {/* Tags */}
                                                        {(comboReadyTags.length > 0 || providesTags.length > 0) && (
                                                            <div className="flex flex-wrap gap-1">
                                                                {comboReadyTags.map(tag => (
                                                                     <span key={tag} className="bg-rose-900/30 text-rose-400 border border-rose-900/50 px-1.5 py-0.5 rounded text-[9px] font-bold">
                                                                        ‚òÖ {tag}
                                                                     </span>
                                                                ))}
                                                                {providesTags.map(tag => (
                                                                     <span key={tag} className="bg-slate-800 text-slate-400 border border-slate-700 px-1.5 py-0.5 rounded text-[9px] font-medium">
                                                                        + {tag}
                                                                     </span>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </button>
                                        );
                                    })}
                                    {playerHand.length === 0 && (
                                        <div className="col-span-full py-8 flex flex-col items-center justify-center text-slate-600 border-2 border-dashed border-slate-800 rounded-xl">
                                            <IconBookOpen className="mb-2 opacity-50" size={24} />
                                            <p className="text-xs font-medium">No cards available</p>
                                        </div>
                                    )}
                                </div>
                            </section>
                        </div>

                        {/* RIGHT COLUMN: LOGS & INFO */}
                        <div className="lg:col-span-3 space-y-6">

                            {/* Game Log Component */}
                            <div className="bg-slate-900 border border-slate-800 rounded-2xl overflow-hidden flex flex-col h-[500px] shadow-lg shadow-black/20 sticky top-24">
                                <div className="bg-slate-800/50 p-3 border-b border-slate-800 flex justify-between items-center">
                                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                                        <IconRefreshCw size={12} /> Game Log
                                    </h3>
                                    <span className="text-[10px] text-slate-600 font-mono">LIVE</span>
                                </div>

                                <div className="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-slate-900">
                                    {logs.map((log, i) => (
                                        <div key={i} className="text-xs leading-relaxed animate-fade-in">
                                            <div className="flex gap-2 text-slate-400">
                                                <span className="text-cyan-700 mt-0.5 select-none text-[8px]">‚óè</span>
                                                <span className={`${i===0 ? 'text-slate-200 font-medium' : ''}`}>{log}</span>
                                            </div>
                                            {i === 0 && <div className="mt-2 h-px bg-gradient-to-r from-cyan-900/50 to-transparent"></div>}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* START SCREEN / OVERLAY */}
                            {gameState === 'START' && (
                                <div className="fixed inset-0 z-[100] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-4">
                                    <div className="bg-slate-800 border border-slate-700 p-8 rounded-2xl shadow-2xl max-w-lg w-full text-center relative overflow-hidden">
                                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-rose-500"></div>

                                        <div className="bg-slate-900 inline-flex p-4 rounded-full mb-6 border border-slate-700 shadow-xl">
                                            <IconTrendingUp size={48} className="text-cyan-400" />
                                        </div>

                                        <h2 className="text-3xl font-black text-white mb-2 tracking-tighter">Economics Master</h2>
                                        <p className="text-slate-400 mb-8 font-medium">ÁµåÊ∏àÊà¶Áï•„Ç´„Éº„Éâ„Ç≤„Éº„É†„Å∏„Çà„ÅÜ„Åì„Åù</p>

                                        <div className="space-y-4 mb-8 text-left bg-slate-900/50 p-6 rounded-xl border border-slate-700/50 text-sm text-slate-300">
                                            <p className="flex items-start gap-2">
                                                <span className="text-cyan-400 font-bold">1.</span>
                                                <span><strong className="text-white">GDP 300ÂÖÜÂÜÜ</strong> „ÇíÈÅîÊàê„Åô„Çå„Å∞ÂãùÂà©„ÄÇ</span>
                                            </p>
                                            <p className="flex items-start gap-2">
                                                <span className="text-cyan-400 font-bold">2.</span>
                                                <span>ÊîØÊåÅÁéá„Åå <strong className="text-rose-400">0%</strong> „Å´„Å™„Çã„Å®ÊïóÂåó„ÄÇ</span>
                                            </p>
                                            <p className="flex items-start gap-2">
                                                <span className="text-cyan-400 font-bold">3.</span>
                                                <span>„Ç§„É≥„Éï„É¨Áéá„ÄÅÂÇµÂãôÊÆãÈ´ò„ÄÅÈáëÂà©„Å´Ê≥®ÊÑè„Åó„Å™„Åå„ÇâÂõΩ„ÇíÈÅãÂñ∂„Åó„Çà„ÅÜ„ÄÇ</span>
                                            </p>
                                        </div>

                                        <button
                                            onClick={startGame}
                                            className="w-full py-4 bg-gradient-to-r from-cyan-600 to-blue-600 text-white rounded-xl font-bold text-lg shadow-lg shadow-cyan-900/20 hover:scale-105 transition-transform active:scale-95"
                                        >
                                            START GAME
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* WIN/LOSS OVERLAY */}
                            {(gameState === 'WON' || gameState === 'LOST') && (
                                <div className="fixed inset-0 z-[100] bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-4">
                                     <div className={`p-8 rounded-2xl shadow-2xl max-w-md w-full text-center border-2 ${gameState === 'WON' ? 'bg-slate-800 border-cyan-500' : 'bg-slate-800 border-rose-500'}`}>

                                        {gameState === 'WON' ? (
                                            <>
                                                <div className="text-6xl mb-4">üéâ</div>
                                                <h2 className="text-4xl font-black text-cyan-400 mb-2">VICTORY</h2>
                                                <p className="text-slate-300 mb-6">„ÅÇ„Å™„Åü„ÅÆÁµåÊ∏àÊîøÁ≠ñ„ÅØÂ§ßÊàêÂäü„ÇíÂèé„ÇÅ„Åæ„Åó„ÅüÔºÅ</p>
                                            </>
                                        ) : (
                                            <>
                                                <div className="text-6xl mb-4">üíÄ</div>
                                                <h2 className="text-4xl font-black text-rose-500 mb-2">DEFEAT</h2>
                                                <p className="text-slate-300 mb-6">ÊîøÊ®©„ÅØÂ¥©Â£ä„Åó„ÄÅÁµåÊ∏à„ÅØÁ†¥Á∂ª„Åó„Åæ„Åó„Åü...</p>
                                            </>
                                        )}

                                        <button
                                            onClick={startGame}
                                            className="px-8 py-3 bg-slate-700 text-white rounded-xl font-bold hover:bg-slate-600 transition-colors w-full active:scale-95"
                                        >
                                            Play Again
                                        </button>
                                    </div>
                                </div>
                            )}

                        </div>
                    </main>
                </div>
            );
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EconomicCardGame />);
    </script>
</body>
</html>
