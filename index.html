<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç®„Ç≥„Éé„Éü„ÇØ„Çπ„Éª„Éû„Çπ„Çø„Éº - ÁµåÊ∏àÂ≠¶„Ç´„Éº„Éâ„Ç≤„Éº„É†</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS („Éá„Ç∂„Ç§„É≥Áî®) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '"Noto Sans JP"', 'sans-serif'],
                        mono: ['"Noto Sans JP"', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM („Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel (JSX„Çí„Éñ„É©„Ç¶„Ç∂„ÅßÂÆüË°å„Åô„Çã„Åü„ÇÅ„ÅÆ„Ç≥„É≥„Éë„Ç§„É©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆöÁæ© */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        body {
            background-color: #f8fafc;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"), linear-gradient(to bottom right, #f1f5f9, #e2e8f0);
            min-height: 100vh;
        }
    </style>
</head>
<body class="text-slate-800 antialiased selection:bg-brand-100 selection:text-brand-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Sound Manager (Web Audio API) ---
        const SoundManager = {
            ctx: null,
            isMuted: false,

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            },

            playTone(freq, type, duration, vol = 0.1) {
                if (this.isMuted) return;
                try {
                    this.init();
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                    gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + duration);
                } catch (e) {
                    console.error("Audio error:", e);
                }
            },

            playClick() {
                this.playTone(800, 'sine', 0.1, 0.05);
            },

            playError() {
                if (this.isMuted) return;
                try {
                    this.init();
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                    osc.frequency.linearRampToValueAtTime(100, this.ctx.currentTime + 0.3);
                    gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + 0.3);
                } catch (e) {
                    console.error(e);
                }
            },

            playSuccess() {
                this.playTone(1200, 'sine', 0.2, 0.1);
                setTimeout(() => this.playTone(1800, 'sine', 0.4, 0.1), 100);
            },

            playCard(type) {
                if (this.isMuted) return;
                if (type === 'ATTACK') {
                    this.playTone(300, 'square', 0.3, 0.05);
                } else if (type === 'POLICY') {
                    this.playTone(600, 'sine', 0.3, 0.05);
                } else {
                    // PRODUCTION
                    this.playTone(400, 'triangle', 0.1, 0.05);
                    setTimeout(() => this.playTone(600, 'triangle', 0.2, 0.05), 100);
                }
            },

            playGameEnd(win) {
                if (this.isMuted) return;
                if (win) {
                    this.playTone(523.25, 'triangle', 0.2, 0.1); // C5
                    setTimeout(() => this.playTone(659.25, 'triangle', 0.2, 0.1), 200); // E5
                    setTimeout(() => this.playTone(783.99, 'triangle', 0.4, 0.1), 400); // G5
                    setTimeout(() => this.playTone(1046.50, 'triangle', 0.8, 0.1), 600); // C6
                } else {
                    this.playTone(300, 'sawtooth', 0.4, 0.1);
                    setTimeout(() => this.playTone(250, 'sawtooth', 0.4, 0.1), 300);
                    setTimeout(() => this.playTone(200, 'sawtooth', 0.8, 0.1), 600);
                }
            }
        };

        // --- „Ç¢„Ç§„Ç≥„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà (SVGÂüã„ÇÅËæº„Åø) ---
        // GitHub PagesÁ≠â„ÅßÂ§ñÈÉ®„É©„Ç§„Éñ„É©„É™‰æùÂ≠ò„Å´„Çà„Çã„Ç®„É©„Éº„ÇíÈò≤„Åê„Åü„ÇÅSVG„ÇíÁõ¥Êé•ÂÆöÁæ©
        const IconWallet = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>
        );
        const IconTrendingUp = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
        );
        const IconZap = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        );
        const IconShield = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        );
        const IconAlertCircle = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        );
        const IconArrowRight = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        );
        const IconRefreshCw = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
        );
        const IconBookOpen = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const IconVolume2 = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
        );
        const IconVolumeX = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
        );

        // --- „Ç≤„Éº„É†„Éá„Éº„ÇøÂÆöÁæ© ---

        const CARD_TYPES = {
            PRODUCTION: {
                label: 'ÁîüÁî£',
                baseStyle: 'bg-white border-slate-200 hover:border-blue-300 hover:shadow-xl hover:shadow-blue-900/5 hover:-translate-y-1',
                headerStyle: 'bg-blue-50 text-blue-600 border-b border-blue-100',
                icon: <IconZap size={14} className="text-blue-500" />
            },
            POLICY: {
                label: 'ÊîøÁ≠ñ',
                baseStyle: 'bg-white border-slate-200 hover:border-emerald-300 hover:shadow-xl hover:shadow-emerald-900/5 hover:-translate-y-1',
                headerStyle: 'bg-emerald-50 text-emerald-600 border-b border-emerald-100',
                icon: <IconBookOpen size={14} className="text-emerald-500" />
            },
            ATTACK: {
                label: 'Â§ñ‰∫§',
                baseStyle: 'bg-white border-slate-200 hover:border-rose-300 hover:shadow-xl hover:shadow-rose-900/5 hover:-translate-y-1',
                headerStyle: 'bg-rose-50 text-rose-600 border-b border-rose-100',
                icon: <IconShield size={14} className="text-rose-500" />
            },
        };

        const EVENTS = [
            {
                id: 1,
                name: 'ÂéüÊ≤π„Ç∑„Éß„ÉÉ„ÇØ',
                description: 'Ë≥áÊ∫ê‰æ°Ê†ºÈ´òÈ®∞„Åß„ÅÇ„Çâ„ÇÜ„ÇãÊîøÁ≠ñ„Ç≥„Çπ„Éà„Åå20%‰∏äÊòá„Åó„Åæ„Åô„ÄÇ',
                effect: { costMultiplier: 1.2 },
            },
            {
                id: 2,
                name: 'Á∑äÁ∏ÆË≤°Êîø',
                description: 'Ë≤°ÊîøÂÜçÂª∫„ÅÆ„Åü„ÇÅÂèéÂÖ•„ÅåÊØé„Çø„Éº„É≥3ÂÖÜÂÜÜÊ∏õÂ∞ë„Åó„Åæ„Åô„ÄÇ',
                effect: { incomePenalty: 3 },
            },
            {
                id: 3,
                name: 'ÊäÄË°ìÈù©Êñ∞„Éñ„Éº„É†',
                description: '„Ç´„Éº„Éâ„ÅÆÁµåÊ∏àÂäπÊûú„Åå1.3ÂÄç„Å´Â¢óÂπÖ„Åó„Åæ„Åô„ÄÇ',
                effect: { effectMultiplier: 1.3 },
            },
            {
                id: 4,
                name: 'ÊôØÊ∞óÂæåÈÄÄ',
                description: '„Ç´„Éº„Éâ„ÅÆÁµåÊ∏àÂäπÊûú„Åå0.7ÂÄç„Å´Á∏ÆÂ∞è„Åó„ÄÅË≥áÈáëÁπ∞„Çä„ÅåÂé≥„Åó„Åè„Å™„Çä„Åæ„Åô„ÄÇ',
                effect: { effectMultiplier: 0.7, costMultiplier: 1.1 },
            },
        ];

        const INITIAL_DECK = [
            {
                id: 1,
                name: 'Ë®≠ÂÇôÊäïË≥á',
                cost: 30,
                type: 'PRODUCTION',
                effect: (me, opp) => ({ ...me, income: me.income + 5, gdp: me.gdp + 10 }),
                description: 'Â∑•Â†¥„ÅÆÊ©üÊ¢∞„Å™„Å©„ÇíË≥ºÂÖ•„Åó„ÄÅÁîüÁî£ËÉΩÂäõ„ÇíÈ´ò„ÇÅ„Åæ„Åô„ÄÇ',
                tip: '„ÄêÊäïË≥á„ÅÆ‰πóÊï∞ÂäπÊûú„ÄëÊäïË≥á„ÅØÂ∞ÜÊù•„ÅÆÁîüÁî£Âäõ„Å®ÊâÄÂæó„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åô„ÄÇ',
                providesTag: 'infrastructure',
                combosWith: ['infrastructure']
            },
            {
                id: 2,
                name: 'ÊäÄË°ìÈù©Êñ∞',
                cost: 60,
                type: 'PRODUCTION',
                effect: (me, opp) => ({ ...me, income: me.income + 10, gdp: me.gdp + 30 }),
                description: 'AI„ÇÑ„É≠„Éú„ÉÉ„Éà„Å™„Å©„ÅÆÊñ∞ÊäÄË°ì„ÇíÂ∞éÂÖ•„Åó„ÄÅÂäπÁéá„ÇíÂäáÁöÑ„Å´‰∏ä„Åí„Åæ„Åô„ÄÇ',
                tip: '„Äê„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥„ÄëÊäÄË°ìÈÄ≤Ê≠©„ÅØÁµåÊ∏àÊàêÈï∑„ÅÆÊúÄÂ§ß„ÅÆË¶ÅÂõ†„ÅÆ‰∏Ä„Å§„Åß„Åô„ÄÇ',
                providesTag: 'innovation',
                combosWith: ['education', 'infrastructure']
            },
            {
                id: 3,
                name: 'ÂÖ¨ÂÖ±‰∫ãÊ•≠',
                cost: 40,
                type: 'POLICY',
                inflationChange: 1,
                supportChange: 8,
                effect: (me, opp) => ({ ...me, gdp: me.gdp + 25 }),
                description: 'ÈÅìË∑Ø„ÇÑÊ©ã„Çí‰Ωú„Çä„ÄÅÈõáÁî®„Å®ÈúÄË¶Å„ÇíÁîü„ÅøÂá∫„Åó„Åæ„Åô„ÄÇ',
                tip: '„ÄêË≤°ÊîøÊîøÁ≠ñ„ÄëÊîøÂ∫ú„ÅåÊîØÂá∫„ÇíË°å„ÅÜ„Åì„Å®„Åß„ÄÅÊúâÂäπÈúÄË¶Å„ÇíÂâµÂá∫„Åó„Åæ„Åô„ÄÇ',
                providesTag: 'infrastructure'
            },
            {
                id: 4,
                name: 'ÈáëËûçÁ∑©Âíå',
                cost: 0,
                type: 'POLICY',
                inflationChange: 1.5,
                supportChange: 2,
                effect: (me, opp) => ({ ...me, money: me.money + 40 }),
                description: 'Â∏ÇÂ†¥„Å´„ÅäÈáë„ÇíÊµÅ„ÅóËæº„Åø„ÄÅ‰∏ÄÊôÇÁöÑ„Å´Ë≥áÈáë„ÇíÊΩ§Ê≤¢„Å´„Åó„Åæ„Åô„ÄÇ',
                tip: '„Äê„Éû„Éç„Çø„É™„Éº„Éô„Éº„Çπ„ÄëÈáëÂà©„Çí‰∏ã„Åí„Åü„Çä„ÅäÈáë„ÅÆ‰æõÁµ¶Èáè„ÇíÂ¢ó„ÇÑ„Åó„ÄÅÊäïË≥á„Çí‰øÉ„Åó„Åæ„Åô„ÄÇ'
            },
            {
                id: 5,
                name: 'Â¢óÁ®é',
                cost: 0,
                type: 'POLICY',
                inflationChange: -1,
                supportChange: -12,
                effect: (me, opp) => ({ ...me, money: me.money + 60, gdp: me.gdp - 10 }),
                description: 'Á®éÁéá„Çí‰∏ä„ÅíË≥áÈáë„ÇíÁ¢∫‰øù„Åó„Åæ„Åô„Åå„ÄÅÊôØÊ∞ó„ÅØÂ∞ë„ÅóÂÜ∑„ÅàËæº„Åø„Åæ„Åô„ÄÇ',
                tip: '„ÄêÁ∑äÁ∏ÆË≤°Êîø„ÄëË≤°Ê∫êÁ¢∫‰øù„Å´„ÅØÊúâÂäπ„Åß„Åô„Åå„ÄÅÊ∂àË≤ª„ÇÑÊäïË≥á„ÇíÊäëÂà∂„Åô„ÇãÂâØ‰ΩúÁî®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ'
            },
            {
                id: 6,
                name: '„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„ÉóÊîØÊè¥',
                cost: 20,
                type: 'PRODUCTION',
                supportChange: 4,
                effect: (me, opp) => ({ ...me, income: me.income + 8 }),
                description: 'Ëµ∑Ê•≠ÂÆ∂„ÇíÊîØÊè¥„Åó„ÄÅÊñ∞„Åü„Å™„Éì„Ç∏„Éç„Çπ„ÇíËÇ≤„Å¶„Åæ„Åô„ÄÇ',
                tip: '„ÄêÊñ∞Áî£Ê•≠ÂâµÂá∫„ÄëÊñ∞„Åó„ÅÑ‰ºÅÊ•≠„ÅØÂ∞ÜÊù•„ÅÆÂ§ß„Åç„Å™Á®éÂèéÊ∫ê„Å®„Å™„Çä„Åæ„Åô„ÄÇ',
                combosWith: ['innovation', 'education']
            },
            {
                id: 7,
                name: 'Èñ¢Á®éÂºï„Åç‰∏ä„Åí',
                cost: 15,
                type: 'ATTACK',
                targetSupportChange: -5,
                targetEffect: (opp) => ({ ...opp, income: Math.max(0, opp.income - 5), money: Math.max(0, opp.money - 10) }),
                description: 'Ëº∏ÂÖ•ÂìÅ„Å´Á®éÈáë„Çí„Åã„Åë„ÄÅÁõ∏ÊâãÂõΩ„ÅÆËº∏Âá∫Áî£Ê•≠„Å´„ÉÄ„É°„Éº„Ç∏„Çí‰∏é„Åà„Åæ„Åô„ÄÇ',
                tip: '„Äê‰øùË≠∑Ë≤øÊòì„ÄëËá™ÂõΩÁî£Ê•≠„ÇíÂÆà„Çã‰∏ÄÊñπ„Åß„ÄÅË≤øÊòìÊà¶‰∫â„ÅÆ„É™„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ'
            },
            {
                id: 8,
                name: '‰∫∫ÊùêËÇ≤Êàê',
                cost: 25,
                type: 'PRODUCTION',
                supportChange: 5,
                effect: (me, opp) => ({ ...me, income: me.income + 3, gdp: me.gdp + 15 }),
                description: 'ÊïôËÇ≤„Å´ÊäïË≥á„Åó„ÄÅÂä¥ÂÉçËÄÖ„ÅÆ„Çπ„Ç≠„É´„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ',
                tip: '„Äê‰∫∫ÁöÑË≥áÊú¨„ÄëÊïôËÇ≤„É¨„Éô„É´„ÅÆÂêë‰∏ä„ÅØ„ÄÅÈï∑ÊúüÁöÑ„Å™ÁµåÊ∏àÊàêÈï∑„Å´‰∏çÂèØÊ¨†„Åß„Åô„ÄÇ',
                providesTag: 'education'
            },
        ];

        const WINNING_GDP = 300;
        const INFLATION_MIN = -5;
        const INFLATION_MAX = 15;

        const RATING_TIERS = [
            { label: 'AAA', threshold: 0, interestMultiplier: 1, eventDamageMultiplier: 1 },
            { label: 'BBB', threshold: 150, interestMultiplier: 1.25, eventDamageMultiplier: 1.1 },
            { label: 'CCC', threshold: 250, interestMultiplier: 1.6, eventDamageMultiplier: 1.25 },
            { label: 'D', threshold: 400, interestMultiplier: 2, eventDamageMultiplier: 1.5 },
        ];

        const getRatingByDebt = (debt = 0) => {
            const sorted = [...RATING_TIERS].sort((a, b) => b.threshold - a.threshold);
            const found = sorted.find(tier => debt >= tier.threshold);
            return found?.label ?? 'AAA';
        };

        const getRatingInfo = (rating = 'AAA') => RATING_TIERS.find(tier => tier.label === rating) ?? RATING_TIERS[0];

        const clampInflation = (value) => Math.min(INFLATION_MAX, Math.max(INFLATION_MIN, Number(value.toFixed(1))));

        const applyInflationDrift = (value) => {
            const drifted = value > 0 ? value - 0.3 : value < 0 ? value + 0.3 : 0;
            if (Math.abs(drifted) < 0.2) return 0;
            return clampInflation(drifted);
        };

        const applyInflationChange = (state, delta = 0) => {
            if (!delta) return state;
            return { ...state, inflation: clampInflation((state.inflation ?? 0) + delta) };
        };

        const calculateInflatedCost = (baseCost, inflationRate = 0) => {
            return Math.max(0, Math.round(baseCost * (1 + inflationRate / 100)));
        };

        const StatusPanel = ({ data, isEnemy, interest }) => {
            const inflationAlert = (value) => {
                if (value >= 12) return { label: '„Éè„Ç§„Éë„Éº„Ç§„É≥„Éï„É¨', color: 'text-red-600 bg-red-50 ring-red-500/20' };
                if (value >= 8) return { label: 'È´ò„Ç§„É≥„Éï„É¨', color: 'text-orange-600 bg-orange-50 ring-orange-500/20' };
                if (value >= 4) return { label: '„Ç§„É≥„Éï„É¨ÈÄ≤Ë°å', color: 'text-amber-600 bg-amber-50 ring-amber-500/20' };
                if (value <= -2) return { label: '„Éá„Éï„É¨', color: 'text-blue-600 bg-blue-50 ring-blue-500/20' };
                return { label: 'ÂÆâÂÆö', color: 'text-emerald-600 bg-emerald-50 ring-emerald-500/20' };
            };

            const alert = inflationAlert(data.inflation);

            // Theme colors
            const theme = isEnemy ? {
                bg: 'bg-slate-50/80',
                border: 'border-slate-200',
                text: 'text-slate-600',
                accent: 'text-slate-500',
                highlight: 'bg-slate-200',
                bar: 'bg-slate-400'
            } : {
                bg: 'bg-white/90',
                border: 'border-blue-100',
                text: 'text-slate-800',
                accent: 'text-blue-600',
                highlight: 'bg-blue-50',
                bar: 'bg-blue-500'
            };

            return (
                <div className={`relative overflow-hidden p-5 rounded-2xl border-2 transition-all duration-300 backdrop-blur-sm ${theme.bg} ${theme.border} ${!isEnemy && 'shadow-xl shadow-blue-900/5 ring-2 ring-blue-500/5'}`}>
                    {/* Header */}
                    <div className="flex justify-between items-start mb-6">
                        <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-xl flex items-center justify-center shadow-sm ${isEnemy ? 'bg-white text-slate-400 border border-slate-200' : 'bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-blue-200'}`}>
                                {isEnemy ? <IconZap size={20} /> : <IconWallet size={20} />}
                            </div>
                            <div>
                                <div className="flex items-center gap-2">
                                    <h3 className={`font-bold text-lg leading-none ${theme.text}`}>
                                        {isEnemy ? '„É©„Ç§„Éê„É´ÂõΩ' : 'Ëá™ÂõΩ („ÅÇ„Å™„Åü)'}
                                    </h3>
                                    <span className={`text-[10px] font-extrabold px-1.5 py-0.5 rounded uppercase tracking-wider ${isEnemy ? 'bg-slate-200 text-slate-500' : 'bg-blue-100 text-blue-600'}`}>
                                        {isEnemy ? 'AI' : 'YOU'}
                                    </span>
                                </div>
                                <div className="text-xs text-slate-400 mt-1 font-medium flex items-center gap-1">
                                    ‰ø°Áî®Ê†º‰ªò:
                                    <span className={`font-bold ${['AAA','BBB'].includes(data.rating) ? 'text-emerald-600' : 'text-amber-600'}`}>{data.rating}</span>
                                </div>
                            </div>
                        </div>

                        <div className="text-right">
                            <div className="text-[10px] uppercase tracking-wider text-slate-400 font-bold mb-0.5">GDP (Goal: 300)</div>
                            <div className={`text-3xl font-black tracking-tighter ${isEnemy ? 'text-slate-600' : 'text-blue-600'}`}>
                                {data.gdp}<span className="text-sm font-bold ml-1 text-slate-400">ÂÖÜ</span>
                            </div>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-2 gap-3 mb-4">
                        {/* Money */}
                        <div className="bg-white/50 p-3 rounded-xl border border-slate-100">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-slate-400 flex items-center gap-1">
                                    Ë≥áÈáëÊÆãÈ´ò
                                </span>
                                <span className="text-sm font-bold font-mono text-slate-700">¬•{data.money}</span>
                            </div>
                            <div className="w-full bg-slate-100 rounded-full h-1.5 overflow-hidden mb-2">
                                <div className={`h-full rounded-full transition-all duration-500 ${theme.bar}`} style={{ width: `${Math.min(100, data.money)}%` }}></div>
                            </div>
                            <div className="flex justify-between text-[10px] font-medium text-slate-400">
                                <span>ÂèéÊîØ: <span className="text-emerald-600">+{data.income}</span></span>
                                <span>Âà©Êâï: <span className="text-rose-500">-{interest}</span></span>
                            </div>
                        </div>

                        {/* Support */}
                        <div className="bg-white/50 p-3 rounded-xl border border-slate-100">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-slate-400">ÂõΩÊ∞ëÊîØÊåÅÁéá</span>
                                <span className={`text-sm font-bold font-mono ${data.support < 30 ? 'text-rose-500' : 'text-slate-700'}`}>{data.support}%</span>
                            </div>
                            <div className="w-full bg-slate-100 rounded-full h-1.5 overflow-hidden">
                                <div className={`h-full rounded-full transition-all duration-500 ${data.support < 30 ? 'bg-rose-500' : 'bg-indigo-500'}`} style={{ width: `${data.support}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* Footer Stats */}
                    <div className="flex gap-2">
                        <div className="flex-1 bg-slate-100/50 p-2 rounded-lg border border-slate-100 flex justify-between items-center">
                            <span className="text-[10px] font-bold text-slate-400">ÂÇµÂãôÊÆãÈ´ò</span>
                            <span className="text-xs font-bold text-slate-600">{data.debt}ÂÖÜ</span>
                        </div>
                        <div className={`flex-1 p-2 rounded-lg border ring-1 flex justify-between items-center ${alert.color}`}>
                            <span className="text-[10px] font-bold opacity-70">„Ç§„É≥„Éï„É¨</span>
                            <span className="text-xs font-bold">{data.inflation.toFixed(1)}%</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- „É°„Ç§„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---

        function EconomicCardGame() {
            const [turn, setTurn] = useState(1);
            const [gameState, setGameState] = useState('START'); // START, PLAYING, WON, LOST
            const [logs, setLogs] = useState(['„Ç≤„Éº„É†ÈñãÂßãÔºÅÁõÆÊ®ôÔºöGDP 300ÂÖÜÂÜÜÂà∞ÈÅî']);
            const [activeEvent, setActiveEvent] = useState(null);
            const [lastTags, setLastTags] = useState([]);
            const [isMuted, setIsMuted] = useState(false);

            useEffect(() => {
                SoundManager.isMuted = isMuted;
            }, [isMuted]);
            
            // „Éó„É¨„Ç§„É§„ÉºÁä∂ÊÖã
            const [player, setPlayer] = useState({
                name: '„ÅÇ„Å™„Åü',
                money: 100,
                income: 10,
                gdp: 0,
                inflation: 0,
                support: 70,
                debt: 0,
                rating: 'AAA',
                interestDue: 0,
            });
            const [playerHand, setPlayerHand] = useState([]);

            // AIÁä∂ÊÖã
            const [enemy, setEnemy] = useState({
                name: '„É©„Ç§„Éê„É´ÂõΩ',
                money: 100,
                income: 10,
                gdp: 0,
                inflation: 0,
                support: 70,
                debt: 0,
                rating: 'AAA',
                interestDue: 0,
            });

            const getInflationAlert = (value) => {
                if (value >= 12) return { label: '‚ö†Ô∏è „Éè„Ç§„Éë„Éº„Ç§„É≥„Éï„É¨Êá∏Âøµ', color: 'text-red-700 bg-red-100 border-red-200' };
                if (value >= 8) return { label: 'üî• È´ò„Ç§„É≥„Éï„É¨', color: 'text-orange-700 bg-orange-100 border-orange-200' };
                if (value >= 4) return { label: '‚ÜóÔ∏è „Ç§„É≥„Éï„É¨ÈÄ≤Ë°å', color: 'text-amber-700 bg-amber-50 border-amber-200' };
                if (value <= -2) return { label: '‚¨áÔ∏è „Éá„Éï„É¨ÂúßÂäõ', color: 'text-blue-700 bg-blue-50 border-blue-200' };
                return { label: 'ÂÆâÂÆö', color: 'text-green-700 bg-green-50 border-green-200' };
            };

            const applyUnrestPenalty = (state, actorLabel) => {
                if (state.inflation < 8) return state;

                const angerLevel = state.inflation >= 12 ? 'Ëá®Áïå' : state.inflation >= 10 ? 'È´ò„Åæ„Çä' : '‰∏äÊòá';
                const incomePenalty = state.inflation >= 12 ? 4 : 2;
                const gdpPenalty = state.inflation >= 10 ? 5 : 0;
                const penalizedState = {
                    ...state,
                    income: Math.max(0, state.income - incomePenalty),
                    gdp: Math.max(0, state.gdp - gdpPenalty),
                };

                addLog(`${actorLabel}: „Ç§„É≥„Éï„É¨È´òÈ®∞„Å´„Çà„Çä„ÄåÂõΩÊ∞ë„ÅÆ‰∏çÊ∫Ä„Äç„Åå${angerLevel}„ÄÅÊâÄÂæó-${incomePenalty}${gdpPenalty ? ` / GDP-${gdpPenalty}` : ''}`);
                return penalizedState;
            };

            const applySupportChange = (state, delta = 0, actorLabel, reason) => {
                if (!delta) return state;
                const prevSupport = state.support ?? 0;
                const nextSupport = Math.min(100, Math.max(0, prevSupport + delta));
                addLog(`${actorLabel}: ${reason}„ÅßÊîØÊåÅÁéá„Åå${prevSupport}% ‚Üí ${nextSupport}%„Å´Â§âÂåñ`);
                return { ...state, support: nextSupport };
            };

            const applyRatingUpdate = (state, actorLabel) => {
                const nextRating = getRatingByDebt(state.debt ?? 0);
                if (state.rating === nextRating) return state;
                addLog(`${actorLabel}: ÂÇµÂãôÊÆãÈ´ò${state.debt}ÂÖÜ„Å´„Çà„ÇäÊ†º‰ªò„Åë„Åå${state.rating} ‚Üí ${nextRating}„Å´Â§âÂåñ`);
                return { ...state, rating: nextRating };
            };

            const getInterestForTurn = (state) => {
                const ratingInfo = getRatingInfo(state.rating);
                return Math.max(0, Math.round((state.interestDue ?? 0) * ratingInfo.interestMultiplier));
            };

            const applyInterestPayment = (state, actorLabel) => {
                const interest = getInterestForTurn(state);
                if (!interest) return state;
                const afterPayment = { ...state, money: Math.max(0, state.money - interest) };
                addLog(`${actorLabel}: ÂÇµÂãôÂà©Êâï„ÅÑ„Å®„Åó„Å¶ ${interest}ÂÖÜÂÜÜ„ÇíÊîØÊâï„ÅÑ„Åæ„Åó„ÅüÔºàÊ†º‰ªò„Åë: ${state.rating}Ôºâ`);
                return afterPayment;
            };

            // ÂàùÊúüÂåñ
            const startGame = () => {
                SoundManager.init();
                SoundManager.playSuccess();
                const event = chooseRandomEvent();
                setActiveEvent(event);
                setPlayer({ money: 80, income: 20, gdp: 0, inflation: 0, support: 70, debt: 0, rating: 'AAA', interestDue: 0 });
                setEnemy({ money: 80, income: 20, gdp: 0, inflation: 0, support: 70, debt: 0, rating: 'AAA', interestDue: 0 });
                setPlayerHand([]);
                setLastTags([]);
                setTurn(1);
                setLogs([`üì¢ ‰ªä„Çø„Éº„É≥„ÅÆ„Ç§„Éô„É≥„Éà: „Äå${event.name}„Äç - ${event.description}`, '„Ç≤„Éº„É†ÈñãÂßãÔºÅGDP 300ÂÖÜÂÜÜ„ÇíÁõÆÊåá„ÅõÔºÅ']);
                setGameState('PLAYING');
                drawCards(3);
            };

            const addLog = (msg) => {
                setLogs(prev => [msg, ...prev].slice(0, 5));
            };

            const chooseRandomEvent = () => EVENTS[Math.floor(Math.random() * EVENTS.length)];

            const selectTurnEvent = () => {
                const event = chooseRandomEvent();
                setActiveEvent(event);
                addLog(`üì¢ ‰ªä„Çø„Éº„É≥„ÅÆ„Ç§„Éô„É≥„Éà: „Äå${event.name}„Äç - ${event.description}`);
            };

            // „Ç´„Éº„Éâ„Éâ„É≠„ÉºÊ©üËÉΩ
            const drawCards = (count) => {
                const newCards = [];
                for (let i = 0; i < count; i++) {
                    const randomCard = INITIAL_DECK[Math.floor(Math.random() * INITIAL_DECK.length)];
                    newCards.push({ ...randomCard, uniqueId: Math.random() });
                }
                setPlayerHand(prev => [...prev, ...newCards]);
            };

            const issueBonds = () => {
                if (gameState !== 'PLAYING') return;
                SoundManager.playTone(1000, 'sine', 0.1, 0.1);
                setPlayer(prev => {
                    const updated = {
                        ...prev,
                        money: prev.money + 50,
                        debt: (prev.debt ?? 0) + 50,
                        interestDue: (prev.interestDue ?? 0) + 5,
                    };
                    const rated = applyRatingUpdate(updated, '„ÅÇ„Å™„Åü');
                    addLog('„ÅÇ„Å™„Åü: ÂõΩÂÇµÁô∫Ë°åÔºÅË≥áÈáë+50ÂÖÜ / ÂÇµÂãô+50ÂÖÜ„ÄÅÂà©Êâï„ÅÑ5ÂÖÜ/„Çø„Éº„É≥„ÇíËøΩÂä†');
                    return rated;
                });
            };

            const applyEventMultiplier = (prevState, nextState) => {
                if (!activeEvent?.effect?.effectMultiplier) return nextState;
                const multiplier = activeEvent.effect.effectMultiplier;
                const applyScale = (key) => {
                    const delta = nextState[key] - prevState[key];
                    return prevState[key] + Math.round(delta * multiplier);
                };
                return {
                    ...nextState,
                    money: applyScale('money'),
                    income: applyScale('income'),
                    gdp: applyScale('gdp'),
                };
            };

            const COMBO_MULTIPLIER = 1.3;

            const applyComboBonus = (prevState, nextState, matchedTags = []) => {
                if (!matchedTags.length) return nextState;
                const applyScale = (key) => {
                    const delta = nextState[key] - prevState[key];
                    return prevState[key] + Math.round(delta * COMBO_MULTIPLIER);
                };
                return {
                    ...nextState,
                    money: applyScale('money'),
                    income: applyScale('income'),
                    gdp: applyScale('gdp'),
                };
            };

            const getCardProvidedTags = (card) => {
                const tags = [];
                if (Array.isArray(card?.providesTags)) {
                    tags.push(...card.providesTags);
                }
                if (card?.providesTag) {
                    tags.push(card.providesTag);
                }
                return tags;
            };

            const withEventMultiplier = (setter) => (updater) => setter(prev => {
                const next = typeof updater === 'function' ? updater(prev) : updater;
                return applyEventMultiplier(prev, next);
            });

            const calculateAdjustedCost = (baseCost, inflationRate = 0) => {
                const inflated = calculateInflatedCost(baseCost, inflationRate);
                if (!activeEvent?.effect?.costMultiplier) return inflated;
                return Math.max(0, Math.round(inflated * activeEvent.effect.costMultiplier));
            };

            // „Éó„É¨„Ç§„É§„Éº„ÅÆ„Çø„Éº„É≥Âá¶ÁêÜ
            const playCard = (card) => {
                if (gameState !== 'PLAYING') return;

                const adjustedCost = calculateAdjustedCost(card.cost, player.inflation);
                const comboReadyTags = (card.combosWith ?? []).filter(tag => lastTags.includes(tag));
                const providedTags = getCardProvidedTags(card);

                let updatedEnemyState = null;

                if (player.money < adjustedCost) {
                    SoundManager.playError();
                    addLog(`Ë≥áÈáë‰∏çË∂≥„Åß„ÅôÔºàÂøÖË¶Å: ${adjustedCost}ÂÖÜÂÜÜ„ÄÅ„Ç§„É≥„Éï„É¨ÂΩ±Èüø„ÇíÂèçÊò†Ôºâ`);
                    return;
                }

                SoundManager.playCard(card.type);

                if (comboReadyTags.length > 0) {
                    addLog(`üéØ „Ç≥„É≥„ÉúÁô∫ÂãïÔºÅ${comboReadyTags.join(', ')}„Çø„Ç∞„Å®„ÅÆÁõ∏‰πóÂäπÊûú„Åß„Äå${card.name}„Äç„ÅÆÂäπÊûú„ÅåÂº∑Âåñ„Åï„Çå„Åæ„Åô„ÄÇ`);
                }

                // Recalculate or reuse adjustedCost? It is already calculated at top of function.
                // But inflation might have changed? No, synchronous execution.
                const afterCost = { ...player, money: player.money - adjustedCost };

                let nextPlayerState = null;

                if (card.type === 'ATTACK') {
                    const afterSupport = applySupportChange(afterCost, card.supportChange, '„ÅÇ„Å™„Åü', `„Äå${card.name}„Äç„ÅÆÊîøÊ≤ªÁöÑÂΩ±Èüø`);
                    nextPlayerState = afterSupport;
                } else {
                    const afterEffect = card.effect(afterCost, enemy);
                    const comboBoosted = applyComboBonus(afterCost, afterEffect, comboReadyTags);
                    const afterEvent = applyEventMultiplier(afterCost, comboBoosted);
                    const afterInflation = applyInflationChange(afterEvent, card.inflationChange);
                    if (card.inflationChange) {
                        addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„ÅåÁâ©‰æ°„Å´ÂΩ±Èüø (${card.inflationChange > 0 ? '+' : ''}${card.inflationChange}%)`);
                    }
                    const afterUnrest = applyUnrestPenalty(afterInflation, '„ÅÇ„Å™„Åü');
                    const afterSupport = applySupportChange(afterUnrest, card.supportChange, '„ÅÇ„Å™„Åü', `„Äå${card.name}„Äç„ÅÆÂäπÊûú`);
                    nextPlayerState = afterSupport;
                }

                setPlayer(nextPlayerState);

                // ÂäπÊûúÁô∫Âãï
                if (card.type === 'ATTACK') {
                    const eventAwareSetEnemy = withEventMultiplier(setEnemy);
                    eventAwareSetEnemy(prev => {
                        const effected = card.targetEffect ? card.targetEffect(prev, nextPlayerState) : prev;
                        const comboBoosted = applyComboBonus(prev, effected, comboReadyTags);
                        const unrested = applyUnrestPenalty(comboBoosted, '„É©„Ç§„Éê„É´');
                        const withSupport = applySupportChange(unrested, card.targetSupportChange, '„É©„Ç§„Éê„É´', `„Äå${card.name}„Äç„ÅÆÂΩ±Èüø`);
                        updatedEnemyState = withSupport;
                        return withSupport;
                    });
                    addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„Çí‰ΩøÁî®ÔºÅÁõ∏Êâã„ÇíÂ¶®ÂÆ≥„Åó„Åü„ÄÇ`);
                } else {
                    addLog(`„ÅÇ„Å™„Åü: „Äå${card.name}„Äç„Çí‰ΩøÁî®„ÄÇÁµåÊ∏àÂäπÊûúÁô∫ÂãïÔºÅ`);
                }

                // ÊâãÊú≠„Åã„ÇâÂâäÈô§
                setPlayerHand(prev => prev.filter(c => c.uniqueId !== card.uniqueId));

                if (providedTags.length > 0) {
                    setLastTags(prev => Array.from(new Set([...prev, ...providedTags])));
                }

                return checkWinCondition(nextPlayerState, updatedEnemyState ?? enemy);
            };

            // „Çø„Éº„É≥ÁµÇ‰∫ÜÂá¶ÁêÜ & AI„Çø„Éº„É≥
            const endTurn = () => {
                if (gameState !== 'PLAYING') return;

                SoundManager.playClick();

                // 1. ÂèéÂÖ•„ÅÆÂá¶ÁêÜÔºà„Éó„É¨„Ç§„É§„ÉºÔºâ
                const driftedInflation = applyInflationDrift(player.inflation);
                const ratingInfo = getRatingInfo(player.rating);
                const incomePenalty = Math.round((activeEvent?.effect?.incomePenalty ?? 0) * ratingInfo.eventDamageMultiplier);
                const playerIncomeGain = Math.max(0, player.income - incomePenalty);
                let playerAfterIncome = {
                    ...player,
                    money: player.money + playerIncomeGain,
                    inflation: driftedInflation,
                };
                const interestPaid = getInterestForTurn(playerAfterIncome);
                playerAfterIncome = applyInterestPayment(playerAfterIncome, '„ÅÇ„Å™„Åü');
                const ratedPlayer = applyRatingUpdate(playerAfterIncome, '„ÅÇ„Å™„Åü');
                const unrestApplied = applyUnrestPenalty(ratedPlayer, '„ÅÇ„Å™„Åü');
                setPlayer(unrestApplied);
                addLog(`„Çø„Éº„É≥ÁµÇ‰∫Ü: ÂèéÂÖ• +${playerIncomeGain}ÂÖÜÂÜÜ${incomePenalty ? ` („Ç§„Éô„É≥„Éà„Åß-${incomePenalty})` : ''}„ÄÅÂà©Êâï„ÅÑ -${interestPaid}ÂÖÜÂÜÜ„ÄÅ„Ç§„É≥„Éï„É¨Áéá ${player.inflation.toFixed(1)} ‚Üí ${driftedInflation.toFixed(1)}%„ÄÅÊ†º‰ªò„Åë ${ratedPlayer.rating}`);

                // 2. ÂãùÂà©Âà§ÂÆö
                if (checkWinCondition()) return;

                // 3. AI„ÅÆ„Çø„Éº„É≥
                const aiEndedGame = aiTurn();

                // 4. Ê¨°„ÅÆ„Çø„Éº„É≥„ÅÆÊ∫ñÂÇô
                if (!aiEndedGame) {
                    setTurn(prev => prev + 1);
                    drawCards(1);
                    selectTurnEvent();
                }

                setLastTags([]);
            };

            const aiTurn = () => {
                let latestEnemyState = null;

                setEnemy(prev => {
                    const drifted = applyInflationDrift(prev.inflation);
                    if (drifted !== prev.inflation) {
                        addLog(`„É©„Ç§„Éê„É´: „Ç§„É≥„Éï„É¨Áéá ${prev.inflation.toFixed(1)}% ‚Üí ${drifted.toFixed(1)}% (Ëá™ÂãïË™øÊï¥)`);
                    }
                    const afterDrift = { ...prev, inflation: drifted };
                    const ratingInfo = getRatingInfo(afterDrift.rating);
                    const incomePenalty = Math.round((activeEvent?.effect?.incomePenalty ?? 0) * ratingInfo.eventDamageMultiplier);
                    const aiIncomeGain = Math.max(0, afterDrift.income - incomePenalty);
                    let afterIncome = { ...afterDrift, money: afterDrift.money + aiIncomeGain };
                    afterIncome = applyInterestPayment(afterIncome, '„É©„Ç§„Éê„É´');
                    const ratedEnemy = applyRatingUpdate(afterIncome, '„É©„Ç§„Éê„É´');
                    const unrestAdjusted = applyUnrestPenalty(ratedEnemy, '„É©„Ç§„Éê„É´');

                    const potentialActions = INITIAL_DECK.filter(c => calculateAdjustedCost(c.cost, unrestAdjusted.inflation) <= unrestAdjusted.money);

                    if (potentialActions.length === 0) {
                        addLog(`„É©„Ç§„Éê„É´: Ë≥áÈáë‰∏çË∂≥„ÅÆ„Åü„ÇÅË≥áÈáë„ÇíÊ∏©Â≠ò„ÄÇ`);
                        latestEnemyState = unrestAdjusted;
                        return unrestAdjusted;
                    }

                    const aiCard = potentialActions[Math.floor(Math.random() * potentialActions.length)];
                    const inflatedCost = calculateAdjustedCost(aiCard.cost, unrestAdjusted.inflation);
                    let afterPayment = { ...unrestAdjusted, money: unrestAdjusted.money - inflatedCost };

                    if (aiCard.type === 'ATTACK') {
                        const afterSupport = applySupportChange(afterPayment, aiCard.supportChange, '„É©„Ç§„Éê„É´', `„Äå${aiCard.name}„Äç„ÅÆÊîøÊ≤ªÁöÑÂΩ±Èüø`);
                        const eventAwareSetPlayer = withEventMultiplier(setPlayer);
                        eventAwareSetPlayer(prev => {
                            const effected = aiCard.targetEffect ? aiCard.targetEffect(prev, afterSupport) : prev;
                            const unrested = applyUnrestPenalty(effected, '„ÅÇ„Å™„Åü');
                            return applySupportChange(unrested, aiCard.targetSupportChange, '„ÅÇ„Å™„Åü', `„Äå${aiCard.name}„Äç„ÅÆÂΩ±Èüø`);
                        });
                        addLog(`„É©„Ç§„Éê„É´: „Äå${aiCard.name}„Äç„Çí‰ΩøÁî®ÔºÅ`);
                        latestEnemyState = afterSupport;
                        return afterSupport;
                    }

                    const afterEffect = applyEventMultiplier(afterPayment, aiCard.effect(afterPayment, player));
                    const afterInflation = applyInflationChange(afterEffect, aiCard.inflationChange);
                    if (aiCard.inflationChange) {
                        addLog(`„É©„Ç§„Éê„É´: „Äå${aiCard.name}„Äç„ÅßÁâ©‰æ°„ÅåÂ§âÂãï (${aiCard.inflationChange > 0 ? '+' : ''}${aiCard.inflationChange}%)`);
                    }
                    addLog(`„É©„Ç§„Éê„É´: „Äå${aiCard.name}„Äç„Çí‰ΩøÁî®„ÅóÊàêÈï∑‰∏≠...`);
                    const unrested = applyUnrestPenalty(afterInflation, '„É©„Ç§„Éê„É´');
                    const afterSupport = applySupportChange(unrested, aiCard.supportChange, '„É©„Ç§„Éê„É´', `„Äå${aiCard.name}„Äç„ÅÆÂäπÊûú`);
                    latestEnemyState = afterSupport;
                    return afterSupport;
                });

                return checkWinCondition(player, latestEnemyState ?? enemy);
            };

            const checkWinCondition = (nextPlayer = player, nextEnemy = enemy) => {
                if (gameState !== 'PLAYING') return false;

                if (nextPlayer.gdp >= WINNING_GDP) {
                    setGameState('WON');
                    SoundManager.playGameEnd(true);
                    addLog('üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„ÅÇ„Å™„Åü„ÅÆÂõΩ„ÅÆÁµåÊ∏à„ÅåÂãùÂà©„Åó„Åæ„Åó„ÅüÔºÅ');
                    return true;
                }

                if (nextEnemy.gdp >= WINNING_GDP) {
                    setGameState('LOST');
                    SoundManager.playGameEnd(false);
                    addLog('üíÄ ÊÆãÂøµ... „É©„Ç§„Éê„É´ÂõΩ„Å´ÁµåÊ∏àË¶áÊ®©„ÇíÂ•™„Çè„Çå„Åæ„Åó„Åü„ÄÇ');
                    return true;
                }

                if (nextPlayer.support <= 0) {
                    setGameState('LOST');
                    SoundManager.playGameEnd(false);
                    addLog('üíÄ ÊîØÊåÅÁéá„Åå0%„Å´ËêΩ„Å°„ÄÅÊîøÊ®©„ÅåÂ¥©Â£ä„Åó„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇ');
                    return true;
                }

                if (nextEnemy.support <= 0) {
                    setGameState('WON');
                    SoundManager.playGameEnd(true);
                    addLog('üéâ „É©„Ç§„Éê„É´ÂõΩ„ÅÆÊîØÊåÅÁéá„ÅåÂ¥©Â£ä„Åó„ÄÅ„ÅÇ„Å™„Åü„ÅÆÂõΩ„ÅåÂÑ™‰Ωç„Å´Á´ã„Å°„Åæ„Åó„ÅüÔºÅ');
                    return true;
                }

                return false;
            };

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-5xl mx-auto animate-fade-in pb-20 text-slate-800">

                    {/* „Éò„ÉÉ„ÉÄ„Éº */}
                    <header className="flex flex-col md:flex-row md:justify-between md:items-center mb-10 gap-4">
                        <div className="flex items-center gap-4">
                            <div className="bg-gradient-to-br from-slate-800 to-slate-900 text-white p-3.5 rounded-2xl shadow-xl shadow-slate-900/20 ring-4 ring-white">
                                <IconTrendingUp size={28} />
                            </div>
                            <div>
                                <h1 className="text-3xl font-black text-slate-800 tracking-tighter">Economics Master</h1>
                                <div className="flex items-center gap-3 mt-1">
                                    <div className="flex items-center gap-1.5 bg-white border border-slate-200 px-2 py-0.5 rounded-md shadow-sm">
                                        <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                        <span className="text-xs font-bold text-slate-600">TURN {turn}</span>
                                    </div>
                                    <span className="text-xs font-bold text-slate-400">GOAL: GDP {WINNING_GDP}T</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            <button
                                onClick={() => setIsMuted(!isMuted)}
                                className="p-2.5 bg-white text-slate-600 border border-slate-200 rounded-xl hover:bg-slate-50 hover:border-slate-300 transition-all shadow-sm hover:shadow-md"
                                aria-label={isMuted ? "Unmute" : "Mute"}
                            >
                                {isMuted ? <IconVolumeX size={20} /> : <IconVolume2 size={20} />}
                            </button>
                            <button
                                onClick={startGame}
                                className="group px-5 py-2.5 bg-white text-slate-600 border border-slate-200 rounded-xl hover:bg-slate-50 hover:border-slate-300 transition-all font-bold text-sm shadow-sm hover:shadow-md flex items-center gap-2"
                            >
                                <IconRefreshCw size={16} className="group-hover:rotate-180 transition-transform duration-500" />
                                {gameState === 'START' ? 'Start Game' : 'Reset Game'}
                            </button>
                        </div>
                    </header>

                    {activeEvent && gameState === 'PLAYING' && (
                        <div className="mb-8 animate-fade-in">
                            <div className="relative overflow-hidden bg-white border border-amber-100 p-1 rounded-2xl shadow-xl shadow-amber-900/5 ring-1 ring-amber-500/10">
                                <div className="bg-gradient-to-r from-amber-50/80 to-orange-50/80 backdrop-blur-md p-5 rounded-xl flex items-start md:items-center gap-5">
                                    <div className="flex-shrink-0 bg-white p-3 rounded-xl shadow-sm border border-amber-100 text-amber-500">
                                        <IconAlertCircle size={24} />
                                    </div>
                                    <div className="flex-grow">
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="bg-amber-100 text-amber-700 text-[10px] font-black px-2 py-0.5 rounded-full uppercase tracking-widest">News</span>
                                            <span className="text-xs font-bold text-amber-400 uppercase tracking-wider">Current Event</span>
                                        </div>
                                        <h3 className="text-xl font-black text-slate-800 tracking-tight mb-1">{activeEvent.name}</h3>
                                        <p className="text-sm text-slate-600 font-medium leading-relaxed">{activeEvent.description}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {gameState === 'START' && (
                        <div className="bg-white p-8 rounded-xl shadow-lg text-center mb-8 border-2 border-indigo-100 animate-fade-in">
                            <h2 className="text-2xl font-bold mb-4">ÁµåÊ∏àÂ≠¶„Çí„Ç´„Éº„Éâ„ÅßÂ≠¶„Åº„ÅÜ</h2>
                            <p className="mb-6 text-gray-600 leading-relaxed">
                                „ÅÇ„Å™„Åü„ÅØÂõΩÂÆ∂„ÅÆ„É™„Éº„ÉÄ„Éº„Åß„Åô„ÄÇ<br/>
                                „ÄåÊäïË≥á„Äç„ÄåÊîøÁ≠ñ„Äç„ÄåÂ§ñ‰∫§„Äç„Ç´„Éº„Éâ„ÇíÈßÜ‰Ωø„Åó„Å¶„ÄÅ<br/>
                                „É©„Ç§„Éê„É´ÂõΩ„Çà„ÇäÂÖà„Å´ÁµåÊ∏àÊàêÈï∑ÔºàGDP 300ÂÖÜÂÜÜÔºâ„ÇíÈÅîÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                            </p>
                            <button 
                                onClick={startGame}
                                className="px-8 py-3 bg-indigo-600 text-white text-lg rounded-full font-bold shadow-lg hover:bg-indigo-700 hover:scale-105 transition transform"
                            >
                                „Çπ„Çø„Éº„ÉàÔºÅ
                            </button>
                        </div>
                    )}

                    {/* „Ç≤„Éº„É†„Ç®„É™„Ç¢ */}
                    {(gameState === 'PLAYING' || gameState === 'WON' || gameState === 'LOST') && (
                        <div className="space-y-6 animate-fade-in">
                            
                            {/* „Çπ„ÉÜ„Éº„Çø„Çπ„Ç®„É™„Ç¢ (Grid) */}
                            <div className="grid md:grid-cols-2 gap-4">
                                <StatusPanel data={player} isEnemy={false} interest={getInterestForTurn(player)} />
                                <StatusPanel data={enemy} isEnemy={true} interest={getInterestForTurn(enemy)} />
                            </div>

                            {/* „É≠„Ç∞„Å®ÂãùÂà©ÁîªÈù¢ */}
                            <div className="relative min-h-[120px] max-h-[180px] bg-slate-900 rounded-2xl p-4 overflow-y-auto shadow-inner ring-1 ring-white/10 font-mono text-sm leading-relaxed scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent group">
                                {gameState === 'WON' && (
                                    <div className="absolute inset-0 bg-white/95 backdrop-blur-md flex flex-col items-center justify-center z-20 rounded-2xl animate-fade-in">
                                        <div className="bg-yellow-100 p-4 rounded-full mb-4">
                                            <IconTrendingUp size={48} className="text-yellow-600" />
                                        </div>
                                        <h2 className="text-4xl font-black text-slate-800 mb-2 tracking-tight">VICTORY!</h2>
                                        <p className="font-medium text-slate-500">„ÅÇ„Å™„Åü„ÅÆÁµåÊ∏àÊîøÁ≠ñ„ÅØÊàêÂäü„Åó„Åæ„Åó„ÅüÔºÅ</p>
                                        <button onClick={startGame} className="mt-6 px-6 py-3 bg-brand-600 text-white rounded-xl font-bold shadow-lg shadow-brand-500/30 hover:bg-brand-700 transition-all">Play Again</button>
                                    </div>
                                )}
                                {gameState === 'LOST' && (
                                    <div className="absolute inset-0 bg-slate-900/95 backdrop-blur-md flex flex-col items-center justify-center z-20 rounded-2xl animate-fade-in text-white">
                                        <div className="bg-slate-800 p-4 rounded-full mb-4 border border-slate-700">
                                            <IconAlertCircle size={48} className="text-rose-500" />
                                        </div>
                                        <h2 className="text-4xl font-black text-rose-500 mb-2 tracking-tight">DEFEAT...</h2>
                                        <p className="text-slate-400">ÁµåÊ∏àÁ´∂‰∫â„Å´ÊïóÂåó„Åó„Åæ„Åó„Åü...</p>
                                        <button onClick={startGame} className="mt-6 px-6 py-3 bg-white text-slate-900 rounded-xl font-bold hover:bg-slate-200 transition-all">Try Again</button>
                                    </div>
                                )}
                                <div className="space-y-1.5 opacity-80 group-hover:opacity-100 transition-opacity">
                                    {logs.map((log, i) => (
                                        <div key={i} className="flex gap-3 text-slate-300 border-b border-slate-800/50 pb-1.5 last:border-0 last:pb-0">
                                            <span className="text-slate-600 text-xs mt-1 select-none shrink-0">{'>'}</span>
                                            <span>{log}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>


                            {/* ÊâãÊú≠„Ç®„É™„Ç¢ */}
                            <div>
                                <div className="flex justify-between items-end mb-4">
                                    <h3 className="text-sm font-bold text-gray-500 uppercase tracking-wider pl-1">Hand Cards (Click to Play)</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={issueBonds}
                                            disabled={gameState !== 'PLAYING'}
                                            className="bg-amber-500 text-white px-4 py-2 rounded-xl font-bold hover:bg-amber-600 hover:shadow-lg hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:translate-y-0 disabled:shadow-none flex items-center gap-2"
                                        >
                                            <span className="text-xs bg-white/20 px-1.5 py-0.5 rounded">Ë≥áÈáëË™øÈÅî</span>
                                            ÂõΩÂÇµÁô∫Ë°å
                                        </button>
                                        <button
                                            onClick={endTurn}
                                            disabled={gameState !== 'PLAYING'}
                                            className="bg-slate-800 text-white px-6 py-2 rounded-xl font-bold hover:bg-slate-700 hover:shadow-lg hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:translate-y-0 disabled:shadow-none flex items-center gap-2"
                                        >
                                            „Çø„Éº„É≥ÁµÇ‰∫Ü <IconArrowRight size={16} />
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                    {playerHand.map((card) => {
                                        const typeInfo = CARD_TYPES[card.type];
                                        const inflatedCost = calculateAdjustedCost(card.cost, player.inflation);
                                        const canAfford = player.money >= inflatedCost;
                                        const comboReadyTags = (card.combosWith ?? []).filter(tag => lastTags.includes(tag));
                                        const providesTags = getCardProvidedTags(card);
                                        return (
                                            <button
                                                key={card.uniqueId}
                                                onClick={() => playCard(card)}
                                                disabled={!canAfford || gameState !== 'PLAYING'}
                                                className={`
                                                    relative text-left group
                                                    flex flex-col h-full rounded-xl border transition-all duration-300 overflow-hidden
                                                    ${typeInfo.baseStyle}
                                                    ${canAfford ? 'cursor-pointer' : 'opacity-60 cursor-not-allowed grayscale'}
                                                `}
                                            >
                                                {/* Card Header */}
                                                <div className={`px-4 py-3 flex justify-between items-center ${typeInfo.headerStyle}`}>
                                                    <span className="text-[10px] font-black uppercase tracking-wider flex items-center gap-1.5">
                                                        {typeInfo.icon} {typeInfo.label}
                                                    </span>
                                                    <div className="flex flex-col items-end leading-none">
                                                        <span className="font-mono text-lg font-black tracking-tighter">¬•{inflatedCost}</span>
                                                    </div>
                                                </div>

                                                {/* Card Body */}
                                                <div className="p-4 flex flex-col flex-grow bg-white/60">
                                                    <h4 className="font-bold text-slate-800 text-sm mb-2 leading-tight min-h-[2.5em] flex items-center">
                                                        {card.name}
                                                    </h4>

                                                    <p className="text-xs text-slate-600 mb-4 flex-grow leading-relaxed">
                                                        {card.description}
                                                    </p>

                                                    <div className="space-y-1.5">
                                                        {/* Cost Info */}
                                                        {inflatedCost !== card.cost && (
                                                            <div className="text-[10px] text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-100 flex items-center gap-1">
                                                                <IconAlertCircle size={10} />
                                                                „Ç≥„Çπ„ÉàÂ§âÂãï: ¬•{card.cost} ‚Üí ¬•{inflatedCost}
                                                            </div>
                                                        )}

                                                        {/* Tags */}
                                                        {(comboReadyTags.length > 0 || providesTags.length > 0) && (
                                                            <div className="flex flex-wrap gap-1">
                                                                {comboReadyTags.map(tag => (
                                                                     <span key={tag} className="bg-rose-100 text-rose-600 border border-rose-200 px-1.5 py-0.5 rounded text-[10px] font-bold">
                                                                        ‚òÖ {tag}
                                                                     </span>
                                                                ))}
                                                                {providesTags.map(tag => (
                                                                     <span key={tag} className="bg-slate-100 text-slate-500 border border-slate-200 px-1.5 py-0.5 rounded text-[10px] font-medium">
                                                                        + {tag}
                                                                     </span>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>

                                                {/* Footer / Tip */}
                                                <div className="px-4 py-3 bg-slate-50/50 border-t border-slate-100 text-[10px] text-slate-500 leading-tight">
                                                    <span className="font-bold text-slate-400 block mb-1 text-[9px] uppercase">MEMO</span>
                                                    {card.tip}
                                                </div>

                                                {!canAfford && (
                                                    <div className="absolute inset-0 bg-slate-100/50 flex items-center justify-center backdrop-blur-[1px] z-10">
                                                        <span className="bg-slate-800 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg">Ë≥áÈáë‰∏çË∂≥</span>
                                                    </div>
                                                )}
                                            </button>
                                        );
                                    })}
                                    {playerHand.length === 0 && (
                                        <div className="col-span-full py-12 flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-2xl bg-slate-50/50">
                                            <IconBookOpen className="mb-2 opacity-50" size={32} />
                                            <p className="text-sm font-medium">ÊâãÊú≠„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                            <p className="text-xs mt-1">„Çø„Éº„É≥„ÇíÁµÇ‰∫Ü„Åó„Å¶Ê¨°„ÅÆ„Ç´„Éº„Éâ„ÇíÂºï„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EconomicCardGame />);
    </script>
</body>
</html>
